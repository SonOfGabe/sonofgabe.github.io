<!doctype html>

<html lang="en">
   
   
    <head>
       
       
        <!-- META -->
        <meta charset="utf-8">
        <meta name="robots" content="noodp">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
       
        <!-- PAGE TITLE -->
        <title>Красночерное дерево</title>
       
        <!-- FAVICON -->
        <link rel="shortcut icon" href="img/favicon.png">
       
        <!-- FONTS -->
        <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&amp;subset=latin-ext" rel="stylesheet">
       
        <!-- STYLESHEETS -->
        <link rel="stylesheet" type="text/css" href="css/plugins.css">
        <link rel="stylesheet" type="text/css" href="css/main.css">
        
        <!-- css sheet for how the page is laid out -->
		
		<link rel="stylesheet" href="visualizationPageStyle.css">
		<link rel="stylesheet" href="style.css">
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
        <script type="text/javascript" src="js/plugins.js"></script>
        <script type="text/javascript" src="js/main.js"></script>
        <script src="https://unpkg.com/scrollreveal">
            ScrollReveal().reveal({ 
                duration: 6000});
        </script>
        <script>
            $.noConflict();
            // Code that uses other library's $ can follow here.
        </script>
		<!-- jqueury stuff.  Only used for the animation speed slider. -->
		<link rel="stylesheet" href="ThirdParty/jquery-ui-1.8.11.custom.css">
				
        

		<script type="text/javascript" src="ThirdParty/jquery-1.5.2.min.js"></script>

		<script type="text/javascript" src="ThirdParty/jquery-ui-1.8.11.custom.min.js"></script>
		<!-- Javascript for the actual visualization code -->
		<script type = "text/javascript" src = "AnimationLibrary/CustomEvents.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/UndoFunctions.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/AnimatedObject.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/AnimatedLabel.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/AnimatedCircle.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/AnimatedRectangle.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/AnimatedLinkedList.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/HighlightCircle.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/Line.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/ObjectManager.js"> </script>
		<script type = "text/javascript" src = "AnimationLibrary/AnimationMain.js"> </script>

		<script type = "text/javascript" src = "AlgorithmLibrary/Algorithm.js"> </script>
		<script type = "text/javascript" src = "AlgorithmLibrary/RedBlack.js"> </script> 
    </head>

   
    <body onload="init();" class="VisualizationMainPage">

        <!-- IMAGE CONTAINER -->
        <div class="image-container">
           
            <div class="background-img"></div>
            <div class="filter"></div>

        </div>
        <!-- /IMAGE CONTAINER -->

        <nav class="fixed-nav-bar"> 
            <a href="index.html">На главную</a>
            <a href="2.html">Бинарное дерево поиска</a>
            <a href="3.html">AVL - дерево</a>
            <a href="4.html">Красно-черное дерево</a>
            <div>Конструктор деревьев</div>

        </nav>
        <!-- CONTENT AREA -->
        <div class="content-area">


            <!-- CONTENT AREA INNER --> 
            <div class="content-area-inner">


                <!-- INTRO -->
                <section id="intro">


                    <!-- CONTAINER MID -->
                    <div class="container-mid">

                       
                        <!-- ANIMATION CONTAINER -->
                        <div class="animation-container animation-fade-right" data-animation-delay="0">
                        
                            <h1>Красно-черное дерево</h1>
                        
                        </div>
                    


                    </div>
                    <!-- /CONTAINER MID -->


                </section>
                <!-- /INTRO -->

                 <!-- ABOUT -->
                 <section id="little-teory">
                    <h3 class="headline">Немного о красно-черных деревьях</h3>

                    <p  class="scroll-animated">Красно-чёрное дерево (англ. red-black tree, RB tree) — один из видов самобалансирующихся двоичных деревьев поиска, гарантирующих логарифмический рост высоты дерева от числа узлов и позволяющее быстро выполнять основные операции дерева поиска: добавление, удаление и поиск узла. Сбалансированность достигается за счёт введения дополнительного атрибута узла дерева — «цвета». Этот атрибут может принимать одно из двух возможных значений — «чёрный» или «красный».

                        Изобретателем красно-чёрного дерева считают немца Рудольфа Байера. Название «красно-чёрное дерево» структура данных получила в статье Л. Гимбаса и Р. Седжвика (1978). По словам Гимбаса, они использовали ручки двух цветов. По словам Седжвика, красный цвет лучше всех смотрелся на лазерном принтере.
                        
                        Красно-чёрное дерево используется для организации сравнимых данных, таких как фрагменты текста или числа. Листовые узлы красно-чёрных деревьев не содержат данных, благодаря чему не требуют выделения памяти — достаточно записать в узле-предке в качестве указателя на потомка нулевой указатель. Однако, в некоторых реализациях для упрощения алгоритма могут использоваться явные листовые узлы.</p>               
                    <br>
                    <!-- /CLIENTS -->
                </section>
                <!-- /ABOUT -->
                <!-- ABOUT -->
                <section id="about">


                   
                    <!-- CLIENTS -->
                    <br><br><br><br><br><br><br><br>
                    <div class="row clients scroll-animated">
                        
                        <table id="AVL-table">
                            <tbody>
                                <tr>
                                    <td class="column1">
                                        <div id = "algoControlSection">
                                            <!-- Table for buttons to control specific animation (insert/find/etc) -->
                                            <!-- (filled in by javascript code specific to the animtion) -->
                                            <table id="AlgorithmSpecificControls" class="table"> </table> 
                                        </div>
                                    </td>
                                    <td class="column2">
                                        <canvas id="canvas" width="1000" height="550"></canvas>
                                        <div id = "generalAnimationControlSection">
                                            <!-- Table for buttons to control general animation (play/pause/undo/etc) ->
                                            <!-- (filled in by javascript code, specifically AnimationMain.js)  -->
                        
                                            <table id="GeneralAnimationControls">  </table>		
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="inforamtionBlock">
                            <!-- <div id="status"></div>
                            <div id="openstatus" >
                                <img class="arrow1" id="test235" src="https://visualgo.net/img/arrow_white_right.png" alt=">" title="show/hide status panel"
                                onclick="addclass5()">
                            </div> -->
                            
                            <div id="infocode">
                                <h4>История</h4>
                                <button onclick="delhistory()">Очистить</button>
                                <div id="textblock"></div>
                            </div>
                            <div id="opencode">
                                <img class="arrow1" id="test236" src="img/pngwing.com.png" alt=">" title="show/hide status panel"
                                onclick="addclass6()">
                            </div>
                        </div>
                    </div>
                    <!-- /CLIENTS -->


                </section>
                <!-- /ABOUT -->
                
                 <!-- ABOUT -->
                 <section id="teory">
                    <h3 class="headline">Полная теория по красно-черному дереву</h3>
                
                    <p>По своей сути бинарные деревья поиска являются простой структурой данных с эффективными операциями поиска, вставки и удаления за O(lg n) итераций. Это в большой степени справедливое утверждение, если мы предполагаем, что входные данные не упорядочены. Однако по крайней мере в 3 наихудших случаях бинарные деревья поиска перестают быть структурами данных с логарифмической эффективностью, вырождаясь в знаменитый связный список. Два таких наихудших случая - это упорядоченные данные на входе, отсортированные либо в возрастающем, либо в убывающем порядке (третий из упомянутых случаев - the third is outside-in alternating order). При том, что бинарные деревья хранят данные в отсортированном виде, если на входе у нас также упорядоченные данные, это порождает проблему. Например, добавим в бинарное дерево поиска последовательно следующие значения 0, 1, 2, 3, 4. Т.е. каждое новое значение больше предыдущего, оно будет добавлено в правую ветку как дочерний узел к узлу предыдущего значения:</p>
                    <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>
 

                <p>Такое бинарное дерево поиска не очень-то хорошее. Производительность падает с O(lg n) до O(n), потому что теперь дерево фактически является линейной структурой данных. Было бы лучше, если бы каждый узел имел два дочерних узла вместо одного. Т.о., мы бы сполна воспользовались преимуществом бинарной природы дерева поиска:</p>

                    <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                    <p>Много клеток мозга пало в бою за идею, как гарантировать такую оптимальную структуру, которая называется сбалансированным бинарным деревом поиска. К сожалению, поддержание дерева в таком идеально сбалансированном состоянии требует массы усилий, так что невозможно гарантировать постоянство идеальной сбалансированности в любое время. Тем не менее, в наших силах подойти достаточно близко к тому, чтобы гарантировать логарифмическую эффективность дерева. Многие из таких "приближающих" стратегий нашли широкое применение. Два предшественника этих оптимизирующих схем - AVL-деревья и, собственно, красно-чёрные деревья. Здесь мы коснёмся только красно-чёрных деревьев, т.к. по AVL-деревьям есть отдельная статья.</p>

                    <p>Изначально красно-чёрные деревья были абстракцией абстракции, которая стала самостоятельной структурой данных. Рудольф Байер (Rudolf Bayer) предложил абстракцию, которую он назвал симметричным бинарным B-деревом. Мысль состояла в моделировании B-дерева 4-го порядка (каждый узел может иметь 4 ссылки в то время, как бинарное дерево допускает лишь две ссылки на узел). Принимая во внимание, что все пути, ведущие от корня к некоему листу дерева, содержат одно и то же число узлов, все листья в B-дереве находятся на одном уровне. Это идеально сбалансированное дерево, однако не бинарное дерево поиска, как требовалось.</p>

                    <p>Основная идея симметричных бинарных B-деревьев состоит в том, что узел может иметь горизонтальные или вертикальные связи. Т.о., бинарное дерево поиска моделирует структуру узлов B-дерева. Вертикальные связи отделяют друг от друга два разных узла, а горизонтальные - узлы, которые логически рассматриваются, как один узел B-дерева. Ниже приведено сравнение эквивалентных B-деревьев и симметричных бинарных B-деревьев (* = неизвестный узел). Обратите внимание, как структура узлов B-дерева подменяется использованием нескольких узлов бинарного дерева:</p>
                    <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                    <p>Алгоритмы на B-деревьях по меньшей мере запутанны, вероятно потому, что деревья растут вверх, а не вниз, что доставляет проблем программистам. Как итог, алгоритмы на B-деревьях не очень гладко преобразуются в алгоритмы абстрактных симметричных бинарных B-деревьев и они довольно сложны. Несмотря на то, что идея в целом была хороша, симметричным бинарным B-деревьям чего-то не хватало.</p>

                    <p>Позже Робертом Седжвиком (Robert Sedgewick) и Леонидасом Гибасом (Leonidas Guibas) была предложена мнемоническая абстракция, которая облегчала понимание симметричных бинарных B-деревьев (кроме того, название тоже сократилось!). Вводя новый атрибут узла - цвет, вы можете легко дифференцировать вертикальные и горизонтальные связи. В рамках этой абстракции узлы, являющиеся частью одного логического узла B-дерева (горизонтальная связь) имеют красный цвет, в то время, как узлы, отделяющие друг от друга логические узлы B-дерева (вертикальные связи) имеют чёрный цвет. Так на свет появились красно-чёрные деревья. Ниже приводятся деревья из 2, 3 и 4 узлов, представленные в виде красно-чёрной абстрактной модели:</p>

                    <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>
                    <p>Это даёт нам некоторые простые правила для сохранения сбалансированности. Во-первых, красный узел не может иметь дочерний узел также красного цвета, потому что это не удовлетворяет правилам абстракции. Если узел имеет красный цвет, он является частью логического узла, и единственно возможным цветом следующего узла является чёрный, потому что связи красного узла являются частью связей узла B-дерева со следующим узлом B-дерева. Нарушение этого правила называется красным нарушением.</p>
                    <p>Далее, т.к. в B-дереве путь от вершины до листа состоит из одного и того же числа узлов, все листья находятся на одном уровне, число чёрных узлов в любом из путей красно-чёрного дерева должно быть одинаковым. Т.к. материнский чёрный узел и его красные дочерние узлы являются частью одного и того же логического узла, красные узлы в пути не учитываются. Это называется чёрной высотой красно-чёрного дерева. Нарушение этого правила называется чёрным нарушением.</p>
                    <p>Наконец, вершиной красно-чёрного дерева должен быть узел чёрного цвета. Это не лишено смысла, т.к. только чёрный узел может иметь красных детей, а вершина не имеет родительского узла. Однако, это правило применимо к абстракции B-дерева. На деле вершина может быть либо красной, либо чёрной и это никак не влияет на эффективность красно-чёрного дерева.</p>
                    <p>Все алгоритмы, обеспечивающие балансировку красно-чёрного дерева, не должны нарушать ни одного из этих правил. Если все правила соблюдаются, то дерево является действительно красно-чёрным и его высота не может быть короче lg (n + 1), но также не выше 2lg (n + 1). Эти величины логарифмические, так что красно-чёрное дерево гарантирует аппроксимацию наилучшего случая бинарного дерева поиска.</p>
                    <p>Красно-чёрные деревья получили широкое распространение и оригинальная абстракция была заменена структурой данных, которая просто избегает нарушения двух базовых правил: красный узел не может иметь красных потомков и каждый путь состоит из одного и того же числа чёрных узлов. Этого достаточно для выполнения требований, накладываемых красно-чёрными деревьями для обеспечения производительности. Заметьте, что вершина при таких условиях не обязана быть чёрной, но это упрощает алгоритмы, потому что вы можете избежать особого случая красного нарушения на вершине.</p>
                    <p>Прежде чем мы приступим, нам понадобится основа и небольшой скелет для кода. Для начала, структуры узла и дерева. Каким образом вы введёте цвет, зависит от вас. Общее решение - поле перечисляемого типа, принимающее значение одной из констант - одна для чёрного цвета, вторая - для красного. Однако, я считаю, что проще использовать флаг. Если он установлен, узел красный, если не установлен - чёрный. Естественно, можно и инвертировать значения, но в данной статье взведённый флаг будет обозначать красный цвет:</p>
                    <pre class="cpp" style="font-family:monospace; text-align: left;"><span style="color: #0000dd;">1</span> <span style="color: #0000ff;">struct</span> node <span style="color: #008000;">&#123;</span>
                        <span style="color: #0000dd;">2</span>        <span style="color: #0000ff;">int</span> red<span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">3</span>        <span style="color: #0000ff;">int</span> data<span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">4</span>        <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">5</span> <span style="color: #008000;">&#125;</span><span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">6</span>
                        <span style="color: #0000dd;">7</span> <span style="color: #0000ff;">struct</span> tree <span style="color: #008000;">&#123;</span>
                        <span style="color: #0000dd;">8</span>        <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root<span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">9</span> <span style="color: #008000;">&#125;</span><span style="color: #008080;">;</span></pre>

                    <p>Уверен, что если вы не читали прежде прочие мои статьи о деревьях, то массив ссылок будет вас путать. Вместо использования двух указателей - левого и правого, как это делается обычно, я предпочитаю использовать массив, где элемент с индексом 0 содержит левый указатель, а элемент с индексом 1 - правый указатель. Это облегчает задачу объединения симметричных случаев и сокращает код, гарантируя корректность. Это моя личная идиома и насколько мне известно, только я использую её для объединения симметричных случаев. Чтобы свести шок к минимуму, ниже показана разница между "классической" идиомой и моей собственной:</p>
                    <pre class="cpp" style="font-family:monospace; text-align: left;"><span style="color: #0000dd;">1</span> <span style="color: #ff0000; font-style: italic;">/* Classic binary search tree insertion */</span>
                        <span style="color: #0000dd;">2</span> <span style="color: #0000ff;">struct</span> cbt_node <span style="color: #000040;">*</span>cbt_insert <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> cbt_node <span style="color: #000040;">*</span>root, <span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                        <span style="color: #0000dd;">3</span> <span style="color: #008000;">&#123;</span>
                        <span style="color: #0000dd;">4</span>         <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>root <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                        <span style="color: #0000dd;">5</span>                 root <span style="color: #000080;">=</span> make_node <span style="color: #008000;">&#40;</span>data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">6</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>data <span style="color: #000080;">&lt;</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data<span style="color: #008000;">&#41;</span>
                        <span style="color: #0000dd;">7</span>                 root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>left <span style="color: #000080;">=</span> cbt_insert <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>left, data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">8</span>         <span style="color: #0000ff;">else</span>
                        <span style="color: #0000dd;">9</span>                 root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>right <span style="color: #000080;">=</span> cbt_insert <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>right, data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">10</span>
                        <span style="color: #0000dd;">11</span>        <span style="color: #0000ff;">return</span> root<span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">12</span> <span style="color: #008000;">&#125;</span>
                        <span style="color: #0000dd;">13</span>
                        <span style="color: #0000dd;">14</span> <span style="color: #ff0000; font-style: italic;">/* Julienne Walker's binary search tree insertion */</span>
                        <span style="color: #0000dd;">15</span> <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>insert <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root, <span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                        <span style="color: #0000dd;">16</span> <span style="color: #008000;">&#123;</span>
                        <span style="color: #0000dd;">17</span>         <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>root <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                        <span style="color: #0000dd;">18</span>                 root <span style="color: #000080;">=</span> make_node <span style="color: #008000;">&#40;</span>data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">19</span>         <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                        <span style="color: #0000dd;">20</span>                 <span style="color: #0000ff;">int</span> dir <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">&lt;</span> data<span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">21</span>                 root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> insert <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span>, data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">22</span>         <span style="color: #008000;">&#125;</span>
                        <span style="color: #0000dd;">23</span>
                        <span style="color: #0000dd;">24</span>         <span style="color: #0000ff;">return</span> root<span style="color: #008080;">;</span>
                        <span style="color: #0000dd;">25</span> <span style="color: #008000;">&#125;</span></pre>

                        <p>Пока что здесь вроде не видно экономии кода, но если вы добавите 50 строк кода перебалансировки для обоих случаев - левого и правого направления, то легко увидеть, что классическая вставка требует дополнительных 100 строк кода, однако мой код для операции вставки умещается всего в 50 строк, потому что оба симметричных случая объединены в один. В реализации алгоритма результатом этого объединения является использование флага dir, который указывает направление, по которому мы работаем, а !dir - противоположное направление. Когда вы поймёте эту идиому, чтение кода, использующего его перестанет быть трудным.</p>
                        <p>Вернёмся обратно к нашему каркасу. Чтобы не захламлять код дополнительными проверками, му будем использовать небольшую вспомогательную функцию, которая будет определять, что цвет узла красный. Чтобы облегчить жизнь, мы будем исходить из предположения, что лист чёрный, потому что наши листья - указатели на NULL, а попытки исправить красное нарушение с NULL-указателями способны свести с ума</p>
                        <pre class="cpp" style="font-family:monospace; text-align: left;"><span style="color: #0000dd;">1</span> <span style="color: #0000ff;">int</span> is_red <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>         <span style="color: #0000ff;">return</span> root <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span> <span style="color: #000040;">&amp;&amp;</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">==</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">4</span> <span style="color: #008000;">&#125;</span></pre>

                        <p>Наконец, вращение. Любая схема балансировки дерева использует вращения, чтобы изменить структуру дерева без нарушения правил, действующих для бинарных деревьев поиска. Также в этом случае было бы логично использовать перекраску узлов, когда они вращаются. Одиночный поворот в красно-чёрном дереве просто поворачивает узлы, как обычно, затем "окрашивает" старую вершину в красный цвет, а новую - в чёрный. Двойной поворот это просто два одиночных поворота. Этого достаточно для операции вставки, но с удалением всё сложнее (какой шок). Несмотря на это, перекраска может быть полезной нам и при вращениях в алгоритме операции удаления. Мы добавим перекраску в функцию одинарного поворота, а функция двойного поворота будет использовать перекраску не явно:</p>
                        <pre class="cpp" style="font-family:monospace; text-align: left;"><span style="color: #0000dd;">1</span> <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>rot_single <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root, <span style="color: #0000ff;">int</span> dir<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>         <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>save <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">4</span>
                            <span style="color: #0000dd;">5</span>         root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> save<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">6</span>         save<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> root<span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">7</span>
                            <span style="color: #0000dd;">8</span>         root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">9</span>         save<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">10</span>
                            <span style="color: #0000dd;">11</span>        <span style="color: #0000ff;">return</span> save<span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">12</span> <span style="color: #008000;">&#125;</span>
                            <span style="color: #0000dd;">13</span>
                            <span style="color: #0000dd;">14</span> <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>rot_double <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root, <span style="color: #0000ff;">int</span> dir<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">15</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">16</span>        root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span>, <span style="color: #000040;">!</span>dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">17</span>        <span style="color: #0000ff;">return</span> rot_single <span style="color: #008000;">&#40;</span>root, dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">18</span> <span style="color: #008000;">&#125;</span></pre>

                        <p>Не волнуйтесь, мы не будем заниматься вставкой прямо сейчас. Сбалансированные деревья нетривиальная структура данных, а красно-чёрные деревья на этом фоне выглядят исключительно хитро для правильного понимания, потому что даже небольшое изменение в одной части дерева может привести к нарушениям в дальних его частях. Т.о., есть смысл ввести небольшую функцию для верификации, которая будет проверять, не было ли нарушений. Зачем? Может так статься, что алгоритм работает на небольших деревьях, но ломается на крупных и вы не знаете, почему. Используя такую функцию, мы можем быть уверены, что алгоритм работает, если мы нагрузим его достаточным объёмом данных в достаточно большом дереве (слишком большом, чтобы тестировать его вручную). Т.к. эта функция будет использоваться только для отладки, мы можем применить рекурсию и допустить, чтобы наш тестер был медленным:</p>


                        <pre class="cpp" style="font-family:monospace; text-align: left;"><span style="color: #0000dd;">1</span> <span style="color: #0000ff;">int</span> rb_assert <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>        <span style="color: #0000ff;">int</span> lh, rh<span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">4</span>
                            <span style="color: #0000dd;">5</span>        <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>root <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">6</span>               <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">7</span>        <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">8</span>               <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>ln <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">9</span>               <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>rn <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">10</span>
                            <span style="color: #0000dd;">11</span>              <span style="color: #ff0000; font-style: italic;">/* Consecutive red links */</span>
                            <span style="color: #0000dd;">12</span>              <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>root<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">13</span>                     <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>ln<span style="color: #008000;">&#41;</span> <span style="color: #000040;">||</span> is_red <span style="color: #008000;">&#40;</span>rn<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">14</span>                            <span style="color: #0000dd;">puts</span> <span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;Red violation&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">15</span>                            <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">16</span>                     <span style="color: #008000;">&#125;</span>
                            <span style="color: #0000dd;">17</span>              <span style="color: #008000;">&#125;</span>
                            <span style="color: #0000dd;">18</span>
                            <span style="color: #0000dd;">19</span>              lh <span style="color: #000080;">=</span> rb_assert <span style="color: #008000;">&#40;</span>ln<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">20</span>              rh <span style="color: #000080;">=</span> rb_assert <span style="color: #008000;">&#40;</span>rn<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">21</span>
                            <span style="color: #0000dd;">22</span>              <span style="color: #ff0000; font-style: italic;">/* Invalid binary search tree */</span>
                            <span style="color: #0000dd;">23</span>              <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span>ln <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span> <span style="color: #000040;">&amp;&amp;</span> ln<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">&gt;=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">24</span>                     <span style="color: #000040;">||</span> <span style="color: #008000;">&#40;</span>rn <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span> <span style="color: #000040;">&amp;&amp;</span> rn<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">&lt;=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">25</span>              <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">26</span>                     <span style="color: #0000dd;">puts</span> <span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;Binary tree violation&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">27</span>                     <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">28</span>              <span style="color: #008000;">&#125;</span>
                            <span style="color: #0000dd;">29</span>
                            <span style="color: #0000dd;">30</span>              <span style="color: #ff0000; font-style: italic;">/* Black height mismatch */</span>
                            <span style="color: #0000dd;">31</span>              <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>lh <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span> <span style="color: #000040;">&amp;&amp;</span> rh <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span> <span style="color: #000040;">&amp;&amp;</span> lh <span style="color: #000040;">!</span><span style="color: #000080;">=</span> rh<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">32</span>                     <span style="color: #0000dd;">puts</span> <span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;Black violation&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">33</span>                     <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">34</span>              <span style="color: #008000;">&#125;</span>
                            <span style="color: #0000dd;">35</span>
                            <span style="color: #0000dd;">36</span>              <span style="color: #ff0000; font-style: italic;">/* Only count black links */</span>
                            <span style="color: #0000dd;">37</span>              <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>lh <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span> <span style="color: #000040;">&amp;&amp;</span> rh <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">38</span>                     <span style="color: #0000ff;">return</span> is_red <span style="color: #008000;">&#40;</span>root<span style="color: #008000;">&#41;</span> <span style="color: #008080;">?</span> lh <span style="color: #008080;">:</span> lh <span style="color: #000040;">+</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">39</span>              <span style="color: #0000ff;">else</span>
                            <span style="color: #0000dd;">40</span>                     <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">41</span>       <span style="color: #008000;">&#125;</span>
                            <span style="color: #0000dd;">42</span> <span style="color: #008000;">&#125;</span></pre>

                        <p>Этот алгоритм относительно прост. Он совершает обход каждого узла в дереве и проводит различные проверки на самом узле и его потомках. Первое - проверка, имеет ли красный узел красные дочерние узлы. Второе - проверка, что дерево является валидным двоичным деревом поиска. И последнее - подсчёт чёрных узлов в пути, а также проверка на предмет того, что все пути имеют такую же длину - чёрную высоту. В случае, если rb_assert() возвращает 0, наше дерево не является корректно построенным красно-чёрным деревом. В противном случае функция вернёт чёрную высоту всего дерева. Для удобства будет выведено сообщение, поясняющее, какое именно нарушение произошло</p>

                        <h3 class="headline">Вставка снизу вверх</h3>

                        <p>Когда нам нужно добавить элемент в красно-чёрное дерево, мы сразу сталкиваемся с необходимостью принять решение. Какого цвета должен быть новый элемент - красного или чёрного? Какой алгоритм мы будем писать, зависит от этого решения, потому что от этого зависит, будут ли внесены нарушения дерева. Если новый узел чёрный, его вставка в дерево приведёт к чёрному нарушению. Оставшаяся часть алгоритма должна быть сконцентрирована на том, чтобы устранить это чёрное нарушение, не внося красных нарушений. С другой стороны, если новый узел будет красным, есть вероятность возникновения красного нарушения и остальная часть алгоритма должна быть направлена на устранение красного нарушения без внесения чёрных нарушений.</p>
                        <p>Но подождите! Если новый узел красный и он будет добавлен, как дочерний узел чёрного узла, мы избежим нарушений вообще в то время, как при вставке чёрного узла в качестве дочернего узла по отношению к чёрному узлу нарушение будет происходить всегда. Т.о., логически наш выбор - окрашивать новый узел в красный цвет, потому что это даст нам возможность не нарушать правила формирования дерева. Нельзя сказать того же о вставке чёрного узла. Красные нарушения более локализованы и поэтому из проще устранять. По этой причине мы будет окрашивать новые узлы в красный цвет и исправлять красные нарушения во время операции вставки. Лень побеждает! Как насчёт вспомогательной функции, которая будет возвращать новый красный узел?</p>

                        <pre class="cpp" style="font-family:monospace; text-align: left;"> <span style="color: #0000dd;">1</span> <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>make_node <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>       <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>rn <span style="color: #000080;">=</span> <span style="color: #0000dd;">malloc</span> <span style="color: #008000;">&#40;</span><span style="color: #0000dd;">sizeof</span> <span style="color: #000040;">*</span>rn<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">4</span> 
                            <span style="color: #0000dd;">5</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>rn <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">6</span>             rn<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">=</span> data<span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">7</span>             rn<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span> <span style="color: #ff0000; font-style: italic;">/* 1 is red, 0 is black */</span>
                            <span style="color: #0000dd;">8</span>             rn<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">9</span>             rn<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">10</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">11</span> 
                           <span style="color: #0000dd;">12</span>       <span style="color: #0000ff;">return</span> rn<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">13</span> <span style="color: #008000;">&#125;</span></pre>


                        <p>Ах, наконец и вставка. Добавление узла. Вместо того, чтобы красиво рассказывать о красно-чёрных деревьях мы можем уже поиграть с чем-то реальным. Хорошо, давайте вставим новый узел в базовое бинарное дерево поиска - это первое дело в нашей повестке. Затем мы можем пройти обратно вверх и перебалансировать дерево, если у нас возникло красное нарушение. Для простоты в коде вставки мы будем использовать рекурсию с запретом дубликатов. Не забудьте отметить последнюю часть кода, которая красит вершину в чёрный цвет. Это важный момент, потому что он гарантирует ненарушение последнего правила красно-чёрного дерева и позволяет избежать необходимости иметь дело с красными нарушениями на вершине. Код должен быть ясен. Если нет, вам стоит познакомиться с бинарными деревьями поиска.</p>

                        <pre class="cpp" style="font-family:monospace; text-align: left;"> <span style="color: #0000dd;">1</span> <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>insert_r <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root, <span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>root <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">4</span>             root <span style="color: #000080;">=</span> make_node <span style="color: #008000;">&#40;</span>data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">5</span>       <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>data <span style="color: #000040;">!</span><span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">6</span>             <span style="color: #0000ff;">int</span> dir <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">&lt;</span> data<span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">7</span> 
                            <span style="color: #0000dd;">8</span>             root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> insert_r <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span>, data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">9</span> 
                           <span style="color: #0000dd;">10</span>             <span style="color: #ff0000; font-style: italic;">/* Hey, let's rebalance here! */</span>
                           <span style="color: #0000dd;">11</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">12</span> 
                           <span style="color: #0000dd;">13</span>       <span style="color: #0000ff;">return</span> root<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">14</span> <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">15</span> 
                           <span style="color: #0000dd;">16</span> <span style="color: #0000ff;">int</span> insert <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> tree <span style="color: #000040;">*</span>tree, <span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">17</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">18</span>       tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000080;">=</span> insert_r <span style="color: #008000;">&#40;</span>tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root, data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">19</span>       tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">20</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">21</span> <span style="color: #008000;">&#125;</span></pre>

                           <p>Этот код настолько прост, насколько это вообще возможно в случае бинарных деревьев, но мы знаем, что вставка может потребовать перебалансировки дерева снизу вверх, естественно, после рекурсивного вызова должен идти код перебалансировки. Помните те занятия по программированию, где надо было вывести введённую последовательность чисел в обратном порядке, используя рекурсию? Тот же принцип применим и здесь. Мы рекурсивно вызываем функцию, вниз, вниз, вниз (вниз! сесть! встать!), а затем вставляем новый узел, присоединяя его к первому листу, до кторого добираемся (потому что второй лист, до которого мы доберёмся, вероятно вызовет ошибку сегментации (SEGFAULT)). Затем рекурсия раскучивается вспять и мы можем извлечь из этого пользу для себя.</p>
                           <p>Итак, как нам провести проверку на красное нарушение? Очень просто: если какой-то из узлов на пути красный, проверим есть ли у него красные дочерние узлы - первый и второй. Если это так, исправляем. Обратите внимание, что только один дочерний узел будет красным. Если иначе, что-то ещё не так с нашим деревом, потому что таким образом красное нарушение будет присутствовать всегда и дерево не будет правильным красно-чёрным деревом. Однако, мы предположим, что дерево построено правильно, потому что так проще.</p>
                           <p>Хорошо, как нам устранить красное нарушение? Это тоже просто! Здесь возможны лишь три случая и все они просты. В первом случае мы проверяем оба дочерних узла (запомните, мы не проверяем новые узлы). Если оба дочерних узла красные, родительский узел должен быть чёрным, так что нам достаточно просто перевернуть цвета. Родительский узел становится красным, а дочерние узлы - чёрными:</p>


                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>Это решение нашей непосредственной проблемы. Но если меняется цвет родительского узла, возникает риск нарушений далее вверх по дереву по восходящей. Это важный момент, когда дочерние узлы и родительский узел данного узла не меняют цвета. Т.о., красное нарушение не будет распространяться дальше. Если узел 2 на диаграмме выше остался чёрным, мы могли бы закончить. Но ввиду того, что он изменил цвет с чёрного на красный, возможно, что родительский узел также мог быть красным и это уже другое нарушение. Поэтому, в данном случае мы поднимаемся выше и осматриваемся вокруг в поисках возможных проблем.</p>
                           <p>Второй случай, если соседний узел (3 в нашем случае) данного узла (1 в нашем случае) не является красным. Если это так, то переворачивание цветов не сработает, т.к. увеличилась бы чёрная высота нисходящего пути справа от 2. Здесь нам нужно проделать больше работы и это уже требует вращения. Во втором случае левый дочерний узел 1 вызвал бы нарушение, поэтому мы производим один поворот вокруг 2 направо, делаем узел 2 красным, 1 - чёрным:</p>

                           <span class="for_img"><img src="data:image/gif;base64,R0lGODlhPwF4APcAAAAAAIAAAACAAICAAAAAgIAAgACAgICAgMDAwP8AAAD/AP//AAAA//8A/wD//////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP///ywAAAAAPwF4AAAI/wAfCBxIsKDBgwgTKlzIsCGAhwAaSpxIsaLFixgzatzIsaPHjwshihwJsqTJkwpFolzJsqVLgiNjQnxJs2ZCmSRt6tzJ8wHOnxF7CjUJVOXQo0g5Fv2ZtKnFpTGdSp16ECpTqlgLWo2atSvSrTK9ZgXLVazZmmTDnnWa1ujatyjbqoUrVK5buniV/oyxTSCoonl52s0ZuPBTnCq2EQOA44EmoIZtDr4buXJKnDjuwQGQItbiq5ZbLo2hbTPk0KgNWk38GXRqokAT+6ME+LVtq4c017YNsqiYB838mT7NOzTUQ7OXFu8NtBCTG9po714eeakhf4+VU+8IlfRw19sLA/9FLn16+IxQoZcHfx7vT+h/obbXCzSGcPPz6f5sVLD13PwXLaUefgCuNdlMBQZYlHcEJmjWgQ4qCNSAxEX41mAWSmhXhnBNxuFhcn1ooEAhBiWiQxue6JWJPpE1EIsq3tRWjGPBSKJ8WtEYUlo6TmUjTA3+2GNQVr3YY1NCVoVgSEfC9KJ2RjZZF0tJililQ1IK5tKVFnKJZZZo0eRlgWN+CSaVZXInVpoescnkmXFpuaJkRMFZZ09u6vTQS3maaadSR/VJJ5WE/rmRoL2hlWKchRoaIFtdLXmnaI5WtKdUiK50KaN8VipRppr6SOmgnt40J5Jb7gQqjauOGl6rT5X/qtqI28H6qKwkdkidrRglSVmMm15YHK/oAflQAsgm8Gt7lBEbplaS6gepT8lWa62zNR6bLGGBRQTlWdiiB4C15G4bLlvlVhtstzgGGq2TmKYrr7LLaTsvsute6KKqEKkr6bkB3isvwHgKTC7BsPEomcAmIkzRuAYffFvEEusbIp8QM5xvoBSX6zBaHavb4aJUhrxxXSF7jFrGKdMLroclt/wxQyy37HJlNcv8IE43DJRdhUTZPHNI6ZYzEDr3Dq2pzSKvKVMMjjF2H9C9MX0zx+R68wDS6zwgzrxKx3VvOf4kvXNstsTHXptW4/tVuvLcg6w3+bhjNs7zat3P3Sv6/9YPEw0qJS/dD+wN9tv3ao304dXNK88D+JTNN1YL9vUz1dzJO4/c+djD+FA5k5uP3JN3O686CZRj+OeUL4XD1JgLXq43/nxNNusFO7467nmFbu3tpfu4lAppf8t2uuxI/o0/i6cbtlaaM8+wZb5Xu87uzvddVGKX4xR00ZJr/fXAiJMrD/bkUz+25OlrPxIO/Wx2wzSAx36ovOsoL337KJObfPPBM928rhdA4cmEPw9ITuA0Uj3g0W582XMXueZREABWDG/zAh7/sgWz75FreUhLHu8EUz2DPe8kJUwAAUdowA6WpHr5gEcC5uG5DYJOaK9JYQGpAiGxpUtrCdyhqv9wmEMiGohkHmTaCauSsiUuTWcWm1HMjMgWHeLLW7yxV8ScqCGw8ImKmNLhpbiIQi2CjYxdbJdowNhCf60LjYmilhBfpsYvmiyKpkoNi0TiRjgeaoGasqKy/NimlcnoZLhSjRjrZZxEMkeLyzIkzhwZl3cx0jCEpGR1xKNJTWZyIp/sJCfdI0pPkrKUptQVKlMJrlV2MpSzcuUrWylLVkaqlqKEpU9wWUpY6pKX3RoLMHvJw2GiskqRRKExiQkt+6lpmcy8kfEeZslfQnOUCkMRJBFkzWuK52JEm6M3ZYUhGW2xm+N0DxJh0sR0etKFL2KjOx31Hp9NU5AXnKencALdtce87jv/kaM89Qmn4RWvQvi0IUHPtBQx/G06CY3gQu1UuahBqXrdEAj7JDpRhroOdqCBoQxpyMKODsmgartK9UCowo2qzKRgggr3tNPA8HmtpDAFlkzgJz/67aZ6+UMWSxWaU1bhBIEKJE5N51Y7nBbVSgfaY7qCmoChvvSpTYqqVGd3Uw1eFatH6mE80zW6BHTOqWD9UDnZ+UOBoO9aaZXSWtk60LiqCJyqqatd77ovhER0W3uNaZFo1s7AetSZ0DqnYaFpxq8udpl8NBciH2vMZFL2spjNrGYdFBAAOw==" alt="png"></span>

                           <p>Это устраняет красное нарушение, корень поддерева не меняет цвет, так что мы можем быть уверены, что красное нарушение не будет распространяться вверх. Но всё даже лучше! Вращение не меняет чёрную высоту поддерева, дерево теперь сбалансировано и мы готовы со вращением! Но почему не изменилась чёрная высота? Заметьте, что на диаграмме до изменения, чёрная высота левого поддерева узла 2 равна 1 (включая сам узел 2), а чёрная высота правого поддерева узла 2 равна 2. Теперь посмотрим на диаграмму, где изображено дерево после изменения. Высота левого поддерева по прежнему 1, а правого - 2! Не забудьте, что красные узлы не учитываются при подсчёте чёрной высоты.</p>
                           <p>Да, хорошая догадка, это дерево не является валидным красно-чёрным деревом. Почему? Потому что значения чёрной высоты в двух поддеревьях не одинаковы. То, с чем мы здесь столкнулись - чёрное нарушение! Хорошая новость - это никогда не произойдёт. Данный пример был призван лишь продемонстрировать, как работает поворот дерева, не рисуя большого дерева, но именно в точности такое дерево никогда не будет существовать в реальных условиях. Почему? Потому что было чёрное нарушение до вставки узла 0! На самом деле, первое вращение красно-чёрного дерева, состоящего из убывающей последовательности чисел произошло бы только после седьмого числа. Давайте посмотрим на этот случай после вставки 7:</p>


                           <span class="for_img"><img src="data:image/gif;base64,R0lGODlh0gDRAPcAAAAAAIAAAACAAICAAAAAgIAAgACAgICAgMDAwP8AAAD/AP//AAAA//8A/wD//////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP///yH5BAEAABAALAAAAADSANEAAAj/AP8JHEiwoMGDCBMqXMiwocOHECNKnEixosWLGDNq3Mixo0eDKD6KHEmypEmCKFKqXHmypcuXMAeunDkzps2bOCvS3Kkyp8+fQAXyHNozqNGjJYkqDYm0qdOMS4k+nUoVYlSlVbNqLXh16davVbtiBUsWqdIY/uBcLcsWKFEV2/qpjdq2Ls6hYv41S7vWrt+XQ/0wiZFtrte/iE2e5Us3seOPS28U7vu48sbFhsda3nzx7OTGnENPxExZtGmHSiVnlnq6NUOxh13LRgh76OzbB2vzxM0bpW6WvYP/+51SuHDiTI3zRq58ucyuQpvfTi4U9HDpsqk/3w0S+2ntOr2H/wYfXvxm8uXNO0Zvkb16su7Tv7cbX/78svXb32ebv/N+sP35999WAQo4IFUFYpTggYDFtCCDJz1oIIRBSagghRXm5F5NGIpkoUbgqcTNiCMW1eFDG/5EXUoktthicScmxFp0bgnl4o0vxggSXR96xCKOQHIDo46wHYVCkEj2aNxvFSLppJK9MefTkU4+2aGUGlZpJYXIDWkTlVomCWGXJjoY5pYHkuklTGDiuM5A4oiZppprttTmjeX8Eyc7/sg5IFEpxPKPXNa5dGeQ3viDjp/7EdXIPSjEYk+hdoYpTz9oNsoTXJqggNZqO31Z5Zt6ZnrfUDdoQwkKK9gCSmyAhf+5Tp+MzkdUDNqopYI2nWoWq5aJLgoklK4NhYOqrGrzqq+/OulNqcMyONSnKHAKa7M3soMpN+vcU+upPK2gLAqprsqsoUjOIxCtQRLbmqPwoHDIpNdie2aO0g4F1z+MnYvuvTe6W6yaUwKM75gEa3iolgLPRuaUwy2cZMMOEwexTGdSPJ3FGnIlMYnFaVxxbRfveGeZIo9MqYOvAceVjtv5yyaIMMdMU4Y01xxWRynrfCHPPjslcs9BS9Qz0UWjmFTSJY+ENNMy2gk1y4ZO3eDVVi89c9YkPZ0b1x52DDZHXitUts5n0zZ2ROilHfVCbuPGWtxve8xd0KXhXF29J4r/ZZbNMudLslEcY4ilioUjzGSFic95+F1dKh65wg87Pjnklf9H1A3bCKTMynbSSTd8m95CDAo4+NPrjA5O2/k/9zDBt3nG+iN7CtucHrhixkIKneZLqWD67BEOFcsyfgOvlBj9yL57UpvCsmze6kUlRr+sA6avNtXwu3r27y3/z/fgG8pTqq+Ka275tOOF/fNdB78N+aEqT1MM4yf/5VLiTm+b/TNpREF0x77i7eQGfInBNJxXQO+IbnREyQu/QFU/ADaudZmz4OJuIjrJbfBLe7ugBn93F8Dpz4NFKqEJScgl3YjNNy6M0QlBSBsSjg4x1KNaDa91Qxz+r2ky+iFK/9ZGQx8REWuQOaLUuqZErTGxiWGLEBSNWLUpXgaJVtTP1rJonypy0Wgv/KLSVChG1KhIjBz6Wo2mKKIXramHL8uNy3z2o3YlB45DhKGLyiTDjF3nbxF7Eh7bUscw1alJhuybwYTUlEIybJBf+ViVIGkjg1EyK5JkGOEWWSJpcRJkiPzkJZ+SyUSq6JOd1BwqQVkwIHkjHwKxh6mqV6VysCtarcTRPDBlS2Hh0lZaysctcQRHiT0rTpo8VZXYgY9hEjNLQFrHtpIJTCR5Ax98miQ0ccQneQjEHdqsZpDk8Q5bhpODQWLHP+DBDT758pe0RBSmZnVOUQFJWyPqxj/e+f9MceIoH4sy57fYFCRpjuiV/AxYo4JkkISy8i5Iysc72unMParSSQJt1ymBpE+BOPRg/oxmRUGKzlUy8qKidItJT7pQVA6ylLMM6b0gCdOBypSaobRkCwF2yFzOVJGmbGRNQTbKSGayp5sMKpEcycepODJgRaXPHI16siFFNYtpzGMZCbRVrnZVK1f9qlbF6lSyIsisZ0UrKdW6VrYC0q1Ggutbd4hUuV7RZHusq121+BxB7pWKw/HjX8n2VL8OFkSLDGvWhqrQw7ZnlYplGmP76VijrTSyeLtsZS3rpoJMVKObRZGW5DHSh4b2NVV61kdJelraVOlSOG2ta5Gkz9VWsla2XHESPWOL29wiSR6yrGdvcxPRz8Z0uBjjKEB5i9zk4uiYzG1uJVMq3dlSt7rE5SRmoTbZVGI3iDzdrtWGKl6uFdaN3zUaU/WaXrhNtb3wja9wAgIAOw==" alt="png"></span>


                           <p>На данном этапе будет проделано переворачивание цвета, потому что 5, 4 и 6 попадают под упомянутый выше первый случай. Переворачивание цветов может вызвать красное нарушение выше, поэтому мы поднимаемся до узла 3 и видим, что на узле 3 у нас действительно красное нарушение. Теперь применим случай с одиночным поворотом. Посмотрим, что произошло с нашим деревом перед вращением:</p>

                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>


                           <p>Самое важное, что стоит сейчас отметить, это то, что НЕТ чёрного нарушения! Каждый путь имеет по два чёрных узла и единственное нарушение - красное нарушение на узле 3. Когда мы делаем поворот вокруг узла 1, узел 3 становится новым чёрным корнем, а узел 1 становится красным. Дерево выглядит, как показано ниже. Заметьте, нет красных нарушений и все чёрные высоты одинаковы. Так работает случай с одним поворотом:</p>

                           <span class="for_img"><img src="data:image/gif;base64,R0lGODlh1wCeAPcAAAAAAIAAAACAAICAAAAAgIAAgACAgICAgMDAwP8AAAD/AP//AAAA//8A/wD//////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP///yH5BAEAABAALAAAAADXAJ4AAAj/AP8JHEiwoMGDCBMqXMiwocOHECNKnEixosWLGDNq3Mixo8ePIEOKHEmyZEcUJlOqXMlSIYqXMGO2nEmzZsaYOHHa3MmzZ8GcQHX6HEo0ZdCjMIsqXXoSqVOmUKNKdEoVpdSrWA9WfZq1K9atVL2KZQq26tizQ8uGRcu2plqzbeOurHpDoD9Na+XqJUk1xj+8OPzB4bq3MMiyK2yBImy48cayYvoxYey4ckWwN7bdzWu588SygQcj9Ux6KlgVtvCOLs26YVkV21QfbU3bpVMc/QbHmCZ6du3fP6keskuJM3Dgb1cfX57c9/LjzYE+Zy4wetLpyAdaf4n9t1Xt0f99/+9Oejz4t9XJlzZPEL129Z3ZG9yqFb5j+QiV17e/F/9J/nL555GAAEpF4IAFjnXgRwsm6FODDDp4FYSHSQgVhSFhaKFJGma4YVpEdfihQzItJOJIJ444H0zctMhNiT+RpSJGKLho443mpcjXjJfVeOOPLXInnoE8TgXkkS4KSSRDMH7oI5JI6qgSfjHZ2GSBT0IZZVbsZXmklJ55qeWPYBoF3phBltmYmGji2BVKbGqpZn9tjjknX3W6CV+ceQbJZZ96ksdni+X0g+adIg1q555QfvOPP4d+BSiZgkIpzz/4GBppVIrWiaiCUKrDTTmQbnohlOUMdI+c3XVaaJufnv8EJTvwwNrqmKTayimU+dRq6nOdrqPpoqci2c0/4niKnaulEktWo/4MlCyry2r5qrPPIklqst40u2W1qHr7bbFjfuMPOtRO16mu5GrpDbLpAjspkLFyNKg8pa6zarzyzpukpEhe+s+w497qb70D+huowfMiLKvC/zI6qcMPQ/wif+smebFXGUNJ8VkvwfoxgwqPrKB4i5pc8cQJWlVlktcNCSrLWGoVc3tohZynkvaJqLK9OtvpMoA+n1wdtjKrl+LPN7XHIsw8v6f0RUxb5N+V+y1LI5ePad30kl0Dq1HVEX1KNk9znk1ihd4huBTCas+E6NkCUkxg3P9FiHOGziX/jeKKQXE9X4X6UQ2Xyd/R9/Zs9SreY1lzufcgXE1B/llyU2KOtlpAS/6QdRyGZ1NzY4tO4nZ8oU4T6Iaz7prqicLO0nY60n667XzjPrvspumeEO1Ylw4808NTNHzUgAN/2PGRF9+78r8fjzyN0qss/fPO23x95UelEItAy1Ce+vafO+WXQMSIH1xVMQhm3E1OxXIPHH7J1jeK1ZeNFGyL1WV/4PnZSiNy8z7qHQU1iwGLUZyigu/5ozgFtM1RfDA/FDRQGREUT1V8gA/3UQZ+R2lfb9QXO6Qcwh4oaAQ8SGiirfAvgi58xR+yMUIAPuY29zCEQBL4wdwFBTZ4EWEG/7VXlUNUsIfVoYoY4CFEJFoNKXUJHw7+MsTOHeUGNLRgaqqYPKREpoY27CJQVJANJsQgi058XFBwUEHvpS+N3AOKEIHIxfUhpRH+4KETqRKL9DWxcCAMihBTcIs3AtKHcsxGcRBYR6d5sR8QZGESkXKLguhROnEEyiGYgQLcgDEnCwyh++gIRzHi5AbauOQet/LH+wXyh9/7BwYb+cqcoAYvWPykUMp3lOEQRJWgjF5f0OhK4UEvdEiJBQobcQ9JSvCYAcxeJl2HzB9u41G6DB6TmNdC3w0ImtX0Ji95J0zTIVJzuxMnRNQZTXMuj5rNcyf20Pk60pUEnvG05xP1Of9Oy4XTn3KTp/HouU7O5fNwoyNo6xS4z1KWkDJx89wNabnNMLqlmH4LKEUvZ1Giba6jRUpUSKc20laV1KQnVVdKVUrElVpmPC9L0/RcyhaXIY2mbQmanPCGUxoBiqc9NV7DgiqWjtGLqG8qGVIBptSltqupTlXKoNZRkHcULKppaRO+PIZVqaLpXei6ald3krGt8musbkFTN/IRVq6iFW1oWoe4vvRWuI5JHvb4VV3lhqZ8WPWme53LmLzBVr0GdnbugtdZDytYi22MsXx1LFDralS3QjayUL0sZmmm2dVltrMtqWzEQJvWPk22szr12GlJ26nVknaSWdLmayc309kI2va2uCVKQAAAOw==" alt="png"></span>

                           <p>Теперь довольно легко понять, почему функция rot_single() устанавливает цвет именно так, как она это делает. Наконец случай, когда вместо левого красного дочернего узла красным является правый дочерний узел. Если правый дочерний узел красный, то одинарный поворот здесь не поможет. Это тот случай, когда нужен двойной поворот:</p>

                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>


                           <p>Стойте, стойте, стойте! Средний шаг верен, так? Так почему бы нам просто не сделать единичный поворот? Это ещё один пример, который не будет существовать в реальных условиях, как показано. Заметьте, что первый поворот увеличивает чёрную высоту поддерева левого по отношению к узлу 3. Это могло привести к чёрному нарушению, так что мы продолжаем двойное вращение, чтобы избежать этого. Попробуйте смоделировать такое правильно построенное красно-чёрное дерево, где этот случай имел бы место и убедитесь, что вращение работает так, как мы проделали выше.</p>
                           <p>Мы рассмотрели три случая, а теперь дополним наш код, чтобы он выявлял описанные случаи и мог исправлять подобные ситуации. Запомните, что новые узлы никогда не перебалансируют дерево; алгоритм просто возвращает новый узел, когда достигается лист и листья перебалансируются до уровня верхних узлов. Мы убеждаемся, что если имеет место нарушение, то оно локализовано в поддереве. Т.о., мы можем провести вращения не устанавливая флаг статуса, который предписывает алгоритму продолжать вращения далее по восходящей. На самом деле флаг статуса не нужен вовсе! Возможно переворачивать цвета на обратном пути вверх по дереву даже если может быть сделан одинарный или двойной поворот:</p>



                           <pre class="cpp" style="font-family:monospace; text-align: left;"> <span style="color: #0000dd;">1</span> <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>insert_r <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root, <span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>root <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">4</span>             root <span style="color: #000080;">=</span> make_node <span style="color: #008000;">&#40;</span>data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">5</span>       <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>data <span style="color: #000040;">!</span><span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">6</span>             <span style="color: #0000ff;">int</span> dir <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">&lt;</span> data<span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">7</span>
                            <span style="color: #0000dd;">8</span>             root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> insert_r <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span>, data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">9</span>
                           <span style="color: #0000dd;">10</span>             <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">11</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">12</span>                         <span style="color: #ff0000; font-style: italic;">/* Case 1 */</span>
                           <span style="color: #0000dd;">13</span>                         root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">14</span>                         root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">15</span>                         root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">16</span>                   <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">17</span>                   <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">18</span>                         <span style="color: #ff0000; font-style: italic;">/* Cases 2 &amp; 3 */</span>
                           <span style="color: #0000dd;">19</span>                         <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">20</span>                               root <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>root, <span style="color: #000040;">!</span>dir <span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">21</span>                         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">22</span>                               root <span style="color: #000080;">=</span> rot_double <span style="color: #008000;">&#40;</span>root, <span style="color: #000040;">!</span>dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">23</span>                   <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">24</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">25</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">26</span>
                           <span style="color: #0000dd;">27</span>       <span style="color: #0000ff;">return</span> root<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">28</span> <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">29</span>
                           <span style="color: #0000dd;">30</span> <span style="color: #0000ff;">int</span> insert <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> tree <span style="color: #000040;">*</span>tree, <span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">31</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">32</span>       tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000080;">=</span> insert_r <span style="color: #008000;">&#40;</span>tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root, data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">33</span>       tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">34</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">35</span> <span style="color: #008000;">&#125;</span></pre>


                        <p>Просто, элегантно, это и есть вставка снизу вверх в красно-чёрном дереве! Я советую вам пройтись по примеру, который покрывает все описанные случаи, чтобы убедиться, что это работает. Конечно, у вас есть вспомогательная функция для тестирования, но ведь вы не знаете, вдруг я просто дурачу ваc? Вы узнаете об этом, когда поэкспериментируете на приблизительно 30 случайных числах и оттрассируете вашу программу!</p>
                        <p>Вставка - это на самом деле самая простая операция на красно-чёрных деревьях. Красные нарушения легко обнаруживаются и устраняются, не вызывая проблем. Проблемы наступают, когда вы попытаетесь удалить узел из красно-чёрного дерева. Следующий раздел посвещён описанию операции удаления снизу вверх. Приготовьтесь!</p>  
                        
                        <h3 class="headline">Удаление снизу вверх</h3>

                        <p>Удаление узла из красно-чёрного дерева может послужить причиной сильной боли ниже спины. Это и моё официальное мнение. Я ненавижу эту операцию и научу вас ненавидеть её. В особенности, алгоритм удаления снизу вверх. В особенности, первый способ, который я собираюсь описать</p>
                        <p>При вставке у нас была возможность выбирать цвет нового узла, чтобы сделать жизнь проще. Мы могли спровоцировать красное нарушение и тут же исправить его. Красные нарушения легко исправить и мы пользовались этим обстоятельством себе на пользу, чтобы создать элегантный рекурсивный алгоритм. Когда вы удаляете узел, у вас нет выбора и вы не можете манипулировать цветами. Если цвет узла красный - превосходно! Красные узлы удаляются без каких-либо нарушений. Почему? Ну, по крайней мере, я не вижу способа внести красное нарушение удалением красного узла из верно построенного дерева, но вы можете попытаться найти такой способ. Т.к. красные узлы не участвуют в формировании чёрной высоты, удаление красного узла не влияет на чёрную высоту. Следовательно, удаление красного узла не нарушает правила формирования красно-чёрного дерева.</p>
                        <p>Если узел чёрный, у нас проблема. Удаление чёрного узла наверняка спровоцирует чёрное нарушение, равно как и вставка чёрного узла. Это то обстоятельство, которого мы и пытаемся избежать при вставке, кроме того, весьма вероятно, что это послужит причиной и красного нарушения! Хорошо, давайте сначала удалим узел, а потом подумаем, как устранить нарушения. Ниже показан простой алгоритм рекурсивного удаления узла из чёрно-красного дерева. Если у узла, которой мы собираемся удалить меньше двух дочерних узлов, мы просто заменяем этот узел тем его потомком, который не равен NULL, или просто NULL-указателем, если у этого узла нет дочерних узлов.</p>
                        <p>Достаточно удобно, что здесь мы можем обойтись без перебалансировки. Если узел, который мы собираемся удалить, чёрный и имеет красный дочерний узел, мы можем окрасить потомка в чёрный цвет, тем самым не вызывая нарушений, потому что мы свели случай удаления чёрного узла к удалению красного узла, которое гарантирует отсутствие нарушений. Пусть это будет случай под номером 0.</p>
                        <p>Если у узла два потомка, мы находим такой узел, значение которого предшествуют значению данного узла - младший узел, (т.е., для узла 3 на диаграмме ниже таким узлом будет 2 - перев.) и копируем его данные в наш узел. Затем мы рекурсивно удаляем младший узел, т.к. у него гарантированно по меньшей мере будет один дочерний узел. В целом, наш алгоритм выглядит довольно неплохо, даже с добавлением кода для перебалансировки (простая перекраска после удаления, флаг статуса и загадочная функция remove_balance ()). Заметьте, что корень окрашивается в чёрный цвет под конец, если дерево не пустое:</p>


                        <pre class="cpp" style="font-family:monospace; text-align: left;"> <span style="color: #0000dd;">1</span> <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>remove_r <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root, <span style="color: #0000ff;">int</span> data, <span style="color: #0000ff;">int</span> <span style="color: #000040;">*</span>done<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>root <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">4</span>             <span style="color: #000040;">*</span>done <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">5</span>       <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">6</span>             <span style="color: #0000ff;">int</span> dir<span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">7</span>
                            <span style="color: #0000dd;">8</span>             <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">==</span> data<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">9</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span> <span style="color: #000040;">||</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">10</span>                         <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>save <span style="color: #000080;">=</span>
                           <span style="color: #0000dd;">11</span>                               root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">12</span>
                           <span style="color: #0000dd;">13</span>                         <span style="color: #ff0000; font-style: italic;">/* Case 0 */</span>
                           <span style="color: #0000dd;">14</span>                         <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>root<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">15</span>                               <span style="color: #000040;">*</span>done <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">16</span>                         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>save<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">17</span>                               save<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">18</span>                               <span style="color: #000040;">*</span>done <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">19</span>                         <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">20</span>
                           <span style="color: #0000dd;">21</span>                         <span style="color: #0000dd;">free</span> <span style="color: #008000;">&#40;</span>root<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">22</span>
                           <span style="color: #0000dd;">23</span>                         <span style="color: #0000ff;">return</span> save<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">24</span>                   <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">25</span>                   <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">26</span>                         <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>heir <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">27</span>
                           <span style="color: #0000dd;">28</span>                         <span style="color: #0000ff;">while</span> <span style="color: #008000;">&#40;</span>heir<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">29</span>                               heir <span style="color: #000080;">=</span> heir<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">30</span>
                           <span style="color: #0000dd;">31</span>                         root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">=</span> heir<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">32</span>                         data <span style="color: #000080;">=</span> heir<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">33</span>                   <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">34</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">35</span>
                           <span style="color: #0000dd;">36</span>             dir <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">&lt;</span> data<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">37</span>             root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> remove_r <span style="color: #008000;">&#40;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span>, data, done<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">38</span>
                           <span style="color: #0000dd;">39</span>             <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span><span style="color: #000040;">*</span>done<span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">40</span>                   root <span style="color: #000080;">=</span> remove_balance <span style="color: #008000;">&#40;</span>root, dir, done<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">41</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">42</span>
                           <span style="color: #0000dd;">43</span>       <span style="color: #0000ff;">return</span> root<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">44</span> <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">45</span> 
                           <span style="color: #0000dd;">46</span> <span style="color: #0000ff;">int</span> <span style="color: #0000dd;">remove</span> <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> tree <span style="color: #000040;">*</span>tree, <span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">47</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">48</span>       <span style="color: #0000ff;">int</span> done <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">49</span>
                           <span style="color: #0000dd;">50</span>       tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000080;">=</span> remove_r <span style="color: #008000;">&#40;</span>tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root, data, <span style="color: #000040;">&amp;</span>done<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">51</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">52</span>             tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">53</span>
                           <span style="color: #0000dd;">54</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">55</span> <span style="color: #008000;">&#125;</span></pre>

                           <p>Здесь нам действительно необходим флаг статуса, чтобы уведомить алгоритм, когда остановить перебалансировку. Если remove_balance() вызывается каждый раз при проходе вверх по дереву, будет довольно некрасиво. Т.к. эта функция просто удаляет внешние узлы (не имеющие двух дочерних), нам достаточно лишь установить флаг после удаления узла (если узел красный или применим случай 0) и внутри remove_balance().</p>
                           <p>Ясно, что реальная работа выполняется функцией remove_balance(), но что именно делает эта вспомогательная функция? Конечно же, она обрабатывает все те случаи, возникновение которых может стать результатом удаление чёрного узла! И эта функция почти такая же по объёму кода, как remove_r(). :-( Давайте сначала рассмотрим простые случаи. Если мы удаляем узел и его сосед - чёрный, а его дочерние узлы также оба чёрные, мы имеем дело с простым случаем, который распространяется (на схеме * = удалённое место):</p>


                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>В этом случае мы можем просто перекрасить узел 1 (соседний узел) в красный цвет без внесения красного нарушения, но всё ещё существует вероятность чёрного нарушения, потому что мы уменьшили чёрную высоту левого поддерева узла 3. Это приводит к тому, что оба поддерева узла 3 будут иметь одну и ту же чёрную высоту, но если узел 3 сам является частью поддерева, то с точки зрения родительского узла возникнет чёрное нарушение, потому что чёрная высота соседнего поддерева не уменьшилась. Однако, если родительский узел (3 в нашем случае) изначально был красным, мы можем перекрасить соседний узел в красный цвет, родителя - в чёрный и дело сделано, потому что теперь чёрные высоты сбалансированы на всём восходящем по дереву пути. Для этого мы можем взвести флаг:</p>

                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>Теперь разберёмся с более сложными случаями, когда соседний узел чёрный, а какой-либо из его дочерних узлов или они оба - красные. Вообще, здесь у нас два случая. Если левый потомок соседнего узла красный, всё, что нам нужно сделать, это одиночный поворот. Однако, родительский узел может быть или красным, или чёрным, так что, нам нужно сохранить его цвет и позже восстановить его, потому что при вращении старые цвета старого и нового родительского узла во внимание не принимаются. После поворота новый родительский узел перекрашивается в цвет старого родительского узла, а его дочерние узлы становятся чёрными (на схеме E = какой-либо из двух цветов):</p>

                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>Это восстанавливает чёрную высоту поддерева и флаг статуса может быть установлен, сигнализируя о том, что перебалансировка больше не требуется. То же происходит, если правый дочерний узел соседнего узла красный, за исключением того, что в таком случае мы используем двойной поворот, вместо одинарного. В итоге, цвета становятся идентичными. Помните, что левый дочерний узел соседа в данном случае должен быть чёрным. Если он красный, то применим предыдущий случай:</p>

                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>И всего-то! Но у меня плохие новости для вас. Это были только те случаи, когда соседний узел чёрный. Если сосед красный, всё гораздо хуже. Однако есть и хорошие новости. Дальнейшие рассуждения представляют собой больше теоретический интерес. Вскоре мы научимся полностью избегать случая с красным соседом. Сделайте глубокий вдох и приготовьтесь ко второй половине повествования о случаях перебалансировки при удалении.</p>

                           <p>Готовы? Каждый случай с красным соседом требует по меньшей мере одного поворота, но не более трёх. Но сначала простые случаи. Если сосед красный и оба его дочерних узла чёрные, для восстановления баланса нам нужно сделать один поворот, перекрасить нового родителя в чёрный цвет, правый дочерний узел соседа - в красный. Запомните, при том, что описание и диаграммы иллюстрируют удаление из правого поддерева, случаи симметричны и при применении трюка с индексами направления мы обрабатываем один из таких симметричных случаев (где dir будет равен 1). Это должно быть ясно при взгляде на код:</p>

                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>Изучение диаграммы проясняет, как восстанавливается баланс при исправлении чёрных высот, но превращение узла 2 в красный узел сбивает с толку. Ну, где-то необходим красный, или это повлияет на чёрную высоту дерева, а единственный узел, который мы можем сделать красным с уверенностью - этот конкретный дочерний узел. Я уже не очень помню, как я пришёл к случаям с красными соседями, но я положительно уверен, что здесь не обошлось без спиртного. :-) Второй случай с красным соседом нацелен на внутренний дочерний узел соседа. Этот дочериний узел не может быть NULL-указателем (упражнение: почему?), поэтому мы просто проверяем один из этих узлов и дальше наши действия зависят от того, какой из них красный. Если красный - внешний дочерний узел, мы делаем двойной поворот, окрашиваем новый родительский узел в чёрный цвет, его правый дочерний узел - в чёрный цвет, а левый - в красный:</p>

                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>
                           <p>Это позволяет восстановить чёрную высоту правого поддерева без изменения чёрной высоты левого поддерева. Когда у нас два красных узла, легко один из них сделать чёрным после поворота, а второй оставить, как есть, чтобы избежать нарушения чёрной высоты поддерева, из которого мы и взяли узел. Последний случай, когда правый дочерний узел узла 3 - красный. Хорошие новости в том, что мы можем свести этот случай к предыдущему одиночным поворотом на узле 2, а затем - двойной поворот на узле 5 (предыдущий случай) даст нам ту структуру, которая нам и нужна с такими же цветами, как выше.</p>

                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>Прежде, чем вы начнёте размышлять, что за мешанина должна быть в коде remove_balance(), давайте посмотрим на неё и убедимся, что всё не так уж и плохо. Да, функция длинная, но ни один из случаев не усложняет её до предела. Экономия получена из сходства разных случаев и назначения цветов вне кода их обработки, с целью избежать повторов кода, но мы можем сделать ещё лучше, как вы скоро увидите. Сравните случаи, описанные выше с их обработкой в исходном коде. Все ли случаи здесь обрабатываются?</p>


                           <pre class="cpp" style="font-family:monospace; text-align: left;"> <span style="color: #0000dd;">1</span> <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>remove_balance <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root, <span style="color: #0000ff;">int</span> dir, <span style="color: #0000ff;">int</span> <span style="color: #000040;">*</span>done<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>       <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>p <span style="color: #000080;">=</span> root<span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">4</span>       <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>s <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">5</span>
                            <span style="color: #0000dd;">6</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>s <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span> <span style="color: #000040;">&amp;&amp;</span> <span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">7</span>             <span style="color: #ff0000; font-style: italic;">/* Black sibling cases */</span>
                            <span style="color: #0000dd;">8</span>             <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span> <span style="color: #000040;">&amp;&amp;</span> <span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">9</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>p<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">10</span>                         <span style="color: #000040;">*</span>done <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">11</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">12</span>                   s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">13</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">14</span>             <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">15</span>                   <span style="color: #0000ff;">int</span> save <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">16</span>
                           <span style="color: #0000dd;">17</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">18</span>                         p <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>p, dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">19</span>                   <span style="color: #0000ff;">else</span>
                           <span style="color: #0000dd;">20</span>                         p <span style="color: #000080;">=</span> rot_double <span style="color: #008000;">&#40;</span>p, dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">21</span>
                           <span style="color: #0000dd;">22</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> save<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">23</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">24</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">25</span>                   <span style="color: #000040;">*</span>done <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">26</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">27</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">28</span>       <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">29</span>             <span style="color: #ff0000; font-style: italic;">/* Red sibling cases */</span>
                           <span style="color: #0000dd;">30</span>             <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>r <span style="color: #000080;">=</span> s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">31</span>
                           <span style="color: #0000dd;">32</span>             <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>r<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span> <span style="color: #000040;">&amp;&amp;</span> <span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>r<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">33</span>                   p <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>p, dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">34</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">35</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">36</span>             <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">37</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>r<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">38</span>                         s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>r, <span style="color: #000040;">!</span>dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">39</span>                   p <span style="color: #000080;">=</span> rot_double <span style="color: #008000;">&#40;</span>p, dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">40</span>                   s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">41</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">42</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">43</span>
                           <span style="color: #0000dd;">44</span>             p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">45</span>             p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">46</span>             <span style="color: #000040;">*</span>done <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">47</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">48</span>
                           <span style="color: #0000dd;">49</span>       <span style="color: #0000ff;">return</span> p<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">50</span> <span style="color: #008000;">&#125;</span></pre>

                           <p>Обычно, красно-чёрные деревья сводят случай красного соседа к случаю чёрного соседа. Если вы не знакомы со случаем красного соседа (почему я вам его и показал), смысл такой редукции может показаться чрезвычайно запутанным. Однако, так как родительский узел соседа и дочерные узлы должны быть чёрными, одиночный поворот сместит родительский узел вниз на ту сторону, где мы произвели удаление, затем он окрашивается в красный цвет, а сосед и его дочерние узлы поднимаются вверх, причём сосед становится чёрным. Это не приводит к изменению чёрной высоты дерева, но просто изменяет сторону, на которой находится нарушение. Смещая нарушение вниз, мы можем гарантировать, что новый соседний узел (2 в этом случае) чёрный:</p>

                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>Здесь вещи становятся запутаннее, потому что нам дважды надо менять направление. На этом этапе мы рекурсивно поднимаемся вверх по дереву, но чтобы сократить случай с красным соседом, нам надо спуститься вниз вместе с соседним узлом. Пусть * - это место, где мы удалили узел, а узел 2 - новый сосед. После этого случаи идентичны, но нам следует соблюдать осторожность, чтобы спуститься вниз, ничего не потеряв, и без проблем вернуться обратно:</p>


                           <pre class="cpp" style="font-family:monospace; text-align: left;"> <span style="color: #0000dd;">1</span> <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>remove_balance <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>root, <span style="color: #0000ff;">int</span> dir, <span style="color: #0000ff;">int</span> <span style="color: #000040;">*</span>done<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>       <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>p <span style="color: #000080;">=</span> root<span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">4</span>       <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>s <span style="color: #000080;">=</span> root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">5</span>
                            <span style="color: #0000dd;">6</span>       <span style="color: #ff0000; font-style: italic;">/* Case reduction, remove red sibling */</span>
                            <span style="color: #0000dd;">7</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">8</span>             root <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>root, dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">9</span>             s <span style="color: #000080;">=</span> p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">10</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">11</span>
                           <span style="color: #0000dd;">12</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>s <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">13</span>             <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span> <span style="color: #000040;">&amp;&amp;</span> <span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">14</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>p<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">15</span>                         <span style="color: #000040;">*</span>done <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">16</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">17</span>                   s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">18</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">19</span>             <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">20</span>                   <span style="color: #0000ff;">int</span> save <span style="color: #000080;">=</span> p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">21</span>                   <span style="color: #0000ff;">int</span> new_root <span style="color: #000080;">=</span> <span style="color: #008000;">&#40;</span>root <span style="color: #000080;">==</span> p<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">22</span>
                           <span style="color: #0000dd;">23</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">24</span>                         p <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>p, dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">25</span>                   <span style="color: #0000ff;">else</span>
                           <span style="color: #0000dd;">26</span>                         p <span style="color: #000080;">=</span> rot_double <span style="color: #008000;">&#40;</span>p, dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">27</span>
                           <span style="color: #0000dd;">28</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> save<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">29</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">30</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">31</span>
                           <span style="color: #0000dd;">32</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>new_root<span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">33</span>                         root <span style="color: #000080;">=</span> p<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">34</span>                   <span style="color: #0000ff;">else</span>
                           <span style="color: #0000dd;">35</span>                         root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> p<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">36</span>
                           <span style="color: #0000dd;">37</span>                   <span style="color: #000040;">*</span>done <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">38</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">39</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">40</span>
                           <span style="color: #0000dd;">41</span>       <span style="color: #0000ff;">return</span> root<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">42</span> <span style="color: #008000;">&#125;</span></pre>

                           <p>Перемещения root и p могут запутать, но единственно, чем здесь можно помочь - трассировка выполнения кода, чтобы быть уверенным в понимании почему root и p используются там, где они используются. Помните, я говорил, что сокращение случая запутано (возможно потому, что никто не берёт на себя труд объяснить это), но такое сокращение значительно упрощает код, потому что половину кода, выполняющего нужную нам работу по перебалансировке, можно выкинуть.</p>

                           <h3 class="headline">Вставка сверху вниз</h3>

                           <p>Одно из главных преимуществ красно-чёрных деревьев состоит в том, что алгоритм вставки и удаления может быть написан в один проход сверху вниз, вместо алгоритма, который использует рекурсивный проход вниз, родительские указатели или явный стек для обеспечения возможности пройти назад вверх, чтобы провести перебалансировку. Алгоритмы, работающие снизу вверх кажутся не элегантными, потому что они часто игнорируют полезную работу, которую можно выполнить на пути вниз или при подъёме обратно вверх. Если мы убедимся, что все цвета изменены и проделаны необходимые вращения, нам не нужно подниматься снова вверх и проводить перебалансировку. Это значит, что нам больше не нужна рекурсия или другие трюки, которые делают алгоритм запутаннее. Давайте рассмотрим нерекурсивный алгоритм вставки сверху вниз.</p>
                           <p>Ключевая идея, которую вы должны извлечь из этой статьи - то, что правила одинаковы, вне зависимости, как вы их реализуете. Мы по прежнему имеем дело с тремя случаями при вставке узла в красно-чёрное дерево: отражение цветов, одинарный и двойной поворот. Всё остальное - это каркас и детали. Для вставки сверху вниз рекурсия не даёт выигрыша. Чтобы обойтись без неё, нам необходимо аккуратно сохранять различные указатели, которые выведут нас обратно вверх по дереву. По крайней мере, у нас есть текущий узел в пути (в конце пути - указатель на NULL), его родительский узел и родитель родителя.</p>
                           <p>Чтобы избежать особых случаев, мы также использует в качестве корня дерева пустышку, при этом настоящий корень дерева является правым дочерним узлом этого номинального корня-пустышки. Т.о., нам не нужно постоянно отслеживать особые случаи на границах при перебалансировке на корне. Чтобы сделать вращение проще, мы также добавим указатель на родительский узел дедовского узла (не знаю, как лучше без лишних слов передать это, поэтому пусть будет просто дедовским узлом). Т.е., мы сохраняем по крайней мере три последних уровня нашего пути.</p>
                           <p>В случае с заменой цветов (color flip) мы проверяем дочерние узлы текущего узла. Если они красные, то текущий узел должен быть чёрным и мы проводим замену цвета. Это может вызвать красное нарушение далее вверх по дереву (вот почему мы сохранили указатель на родителя текущего узла). Теперь учитывая то, что замена цветов сразу приведёт к нарушению, мы прямиком приступаем к проверке нарушений между родительским узлом и текущим. Если оба красные, мы совершаем одинарный или двойной поворот вокруг дедовского узла:</p>


                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>Обратите внимание, как происходит вращение вокруг дедовского узла. Исходя из этих особенностей мы и сохраняем указатель на родителя дедовского узла. В противном случае было бы куда сложнее "оповестить" дерево о тех изменениях, которые мы вносим. Код, который творит всё волшебство короче, чем вы могли бы ожидать, но он не следует обычным методикам. Вся работа проделывается в цикле при нисхождении, включая также операцию вставки, т.к. вставка нового красного узла может вызвать красное нарушение. Цикл разрывается, если найдены данные или вставлен новый узел или в случае, если в дереве уже был узел с такими данными. Т.о., алгоритм, представленный ниже не допускает дубликаты и не предупреждает о них:</p>


                           <pre class="cpp" style="font-family:monospace; text-align: left;"><span style="color: #0000dd;">1</span> <span style="color: #0000ff;">int</span> insert <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> tree <span style="color: #000040;">*</span>tree, <span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">4</span>             <span style="color: #ff0000; font-style: italic;">/* Empty tree case */</span>
                            <span style="color: #0000dd;">5</span>             tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000080;">=</span> make_node <span style="color: #008000;">&#40;</span>data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">6</span>             <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">7</span>                   <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">8</span>       <span style="color: #008000;">&#125;</span>
                            <span style="color: #0000dd;">9</span>       <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">10</span>             <span style="color: #0000ff;">struct</span> node head <span style="color: #000080;">=</span> <span style="color: #008000;">&#123;</span> <span style="color: #0000dd;">0</span> <span style="color: #008000;">&#125;</span><span style="color: #008080;">;</span> <span style="color: #ff0000; font-style: italic;">/* False tree root */</span>
                           <span style="color: #0000dd;">11</span>
                           <span style="color: #0000dd;">12</span>             <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>g, <span style="color: #000040;">*</span>t<span style="color: #008080;">;</span>     <span style="color: #ff0000; font-style: italic;">/* Grandparent &amp; parent */</span>
                           <span style="color: #0000dd;">13</span>             <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>p, <span style="color: #000040;">*</span>q<span style="color: #008080;">;</span>     <span style="color: #ff0000; font-style: italic;">/* Iterator &amp; parent */</span>
                           <span style="color: #0000dd;">14</span>             <span style="color: #0000ff;">int</span> dir <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, last<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">15</span>
                           <span style="color: #0000dd;">16</span>             <span style="color: #ff0000; font-style: italic;">/* Set up helpers */</span>
                           <span style="color: #0000dd;">17</span>             t <span style="color: #000080;">=</span> <span style="color: #000040;">&amp;</span>head<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">18</span>             g <span style="color: #000080;">=</span> p <span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">19</span>             q <span style="color: #000080;">=</span> t<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">20</span>
                           <span style="color: #0000dd;">21</span>             <span style="color: #ff0000; font-style: italic;">/* Search down the tree */</span>
                           <span style="color: #0000dd;">22</span>             <span style="color: #0000ff;">for</span> <span style="color: #008000;">&#40;</span> <span style="color: #008080;">;</span> <span style="color: #008080;">;</span> <span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">23</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>q <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">24</span>                         <span style="color: #ff0000; font-style: italic;">/* Insert new node at the bottom */</span>
                           <span style="color: #0000dd;">25</span>                         p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> q <span style="color: #000080;">=</span> make_node <span style="color: #008000;">&#40;</span>data<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">26</span>                         <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>q <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">27</span>                               <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">28</span>                   <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">29</span>                   <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span> link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span> <span style="color: #000040;">&amp;&amp;</span> is_red <span style="color: #008000;">&#40;</span>q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">30</span>                         <span style="color: #ff0000; font-style: italic;">/* Color flip */</span>
                           <span style="color: #0000dd;">31</span>                         q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">32</span>                         q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">33</span>                         q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">34</span>                   <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">35</span>
                           <span style="color: #0000dd;">36</span>                   <span style="color: #ff0000; font-style: italic;">/* Fix red violation */</span>
                           <span style="color: #0000dd;">37</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>q<span style="color: #008000;">&#41;</span> <span style="color: #000040;">&amp;&amp;</span> is_red <span style="color: #008000;">&#40;</span>p<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">38</span>                         <span style="color: #0000ff;">int</span> dir2 <span style="color: #000080;">=</span> t<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">==</span> g<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">39</span>
                           <span style="color: #0000dd;">40</span>                         <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>q <span style="color: #000080;">==</span> p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>last<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">41</span>                               t<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir2<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>g, <span style="color: #000040;">!</span>last<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">42</span>                         <span style="color: #0000ff;">else</span>
                           <span style="color: #0000dd;">43</span>                               t<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir2<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> rot_double <span style="color: #008000;">&#40;</span>g, <span style="color: #000040;">!</span>last<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">44</span>                   <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">45</span>
                           <span style="color: #0000dd;">46</span>                   <span style="color: #ff0000; font-style: italic;">/* Stop if found */</span>
                           <span style="color: #0000dd;">47</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">==</span> data<span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">48</span>                         <span style="color: #0000ff;">break</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">49</span>
                           <span style="color: #0000dd;">50</span>                   last <span style="color: #000080;">=</span> dir<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">51</span>                   dir <span style="color: #000080;">=</span> q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">&lt;</span> data<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">52</span>
                           <span style="color: #0000dd;">53</span>                   <span style="color: #ff0000; font-style: italic;">/* Update helpers */</span>
                           <span style="color: #0000dd;">54</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>g <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">55</span>                         t <span style="color: #000080;">=</span> g<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">56</span>                   g <span style="color: #000080;">=</span> p, p <span style="color: #000080;">=</span> q<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">57</span>                   q <span style="color: #000080;">=</span> q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">58</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">59</span>
                           <span style="color: #0000dd;">60</span>             <span style="color: #ff0000; font-style: italic;">/* Update root */</span>
                           <span style="color: #0000dd;">61</span>             tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000080;">=</span> head.<span style="color: #007788;">link</span> <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">62</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">63</span>
                           <span style="color: #0000dd;">64</span>       <span style="color: #ff0000; font-style: italic;">/* Make root black */</span>
                           <span style="color: #0000dd;">65</span>       tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">66</span>
                           <span style="color: #0000dd;">67</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">68</span> <span style="color: #008000;">&#125;</span></pre>

                           <p>Такая вставка сверху вниз не столь красива, как рекурсивная вставка снизу вверх, однако алгоритм использует все преимущества, предоставляемые свойствами красно-чёрных деревьев и избегает потенциальных проблем рекурсивного алгоритма. Теоретически этот алгоритм более эффективен. :-) Хорошая новость: удаление сверху вниз проще, чем снизу вверх, и мы можем использовать уроки, извлечённые из изучения алгоритма вставки, чтобы сделать нашу реализацию проще. Давайте посмотрим.</p>

                           <h3 class="headline">Удаление сверху вниз</h3>

                           <p>Удаление снизу вверх было проблемой, т.к. нам приходилось восстанавливаться после чёрных нарушений, которые, как мы узнали, сложнее исправить из двух видов нарушений. Однако, удаление было тривиальным, если мы удаляли красный узел, потому что удаление красного узла не нарушало правил красно-чёрного дерева. Если бы мы каким-то образом смогли гарантировать, что удаляемый узел красного цвета, это бы существенно упростило операцию удаления. Хорошая новость: мы можем гарантировать это! Удерживая цвет узла в верхушке дерева красным и сдвигая его вниз, используя замену цветов с вращениями, мы всегда сможем гарантировать, что будет удалён красный узел.</p>
                           <p>Есть только четыре случая сдвига красного узла вниз по дереву без чёрного нарушения. Первый случай - простое обратное отражение цвета. Если узел и его сосед - чёрные, и все четыре их дочерних узла - чёрные, родительский узел перекрашивается в чёрный цвет, а оба его потомка - в красный:</p>




                           <span class="for_img"><img src="data:image/gif;base64,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" alt="png"></span>

                           <p>В принципе, это обратное отражение цветов (reverse color flip), которое мы делали во время вставки. Это сдвигает красные узлы вниз без изменения чёрной высоты дерева, вместо того, чтобы удерживать их наверху. Здорово. :-) Следующий случай - случай с красным соседом, который мы быстро сократим спомощью одинарного поворота, используя трюки, которые мы изучили на примере удаления снизу вверх. Этот случай довольно интуитивен теперь, когда нам не нужно менять направление, чтобы всё работало. Заметьте, что ни чёрная высота, ни цвет родительского узла не изменяются. Т.к. мы двигаемся вниз, сдвигание и соседних узлов вниз - то, что нужно:</p>

                           <span class="for_img"><img src="data:image/gif;base64,R0lGODlhzQBnAPcAAAAAAIAAAACAAICAAAAAgIAAgACAgICAgMDAwP8AAAD/AP//AAAA//8A/wD//////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP///ywAAAAAzQBnAAAI/wAfCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzGgTAsaPGjyBDihyZsaPJkyRTqlzJsuLJlyhbykz5cqZKmDg92tx5MadOniV95gRK9KHQmEUnHvWZtOnBpUidNoTKVKpTqlGtIsRaVStQrlm9EgSLUyxPsmHFoi1rVubatFrf1mzbUu7PtkLHHqXL0q5Junn/7uV7cy9UwEwFDyY8cvBhvIk9LmXcOPCDx2YDS15M+eNhqpCHKs7bGeRnzF41c7xMurTnyaBDw2S9mrNrjKcny645euhtjblbZ+5Km/jvnoZ1I7Z7/LVq4cOZNw/qFwBj6dOpy+38Nrvz7dzJev83Db402PEhu//Gehk9+fPTOVt3rz32+Lkb6fcUyH6+/oT+/RdRgMWxxZ+AACIIEYF6/fWUgg9CuBCDSklYEIUWtgdchgNhCKGHFIH4n4f4xdcYhxo2mMCKLN5lVYkd0oSifxyxaOONq11VI445pkgShjAeZx0ANxaJY1I7Gtlijzc16FtzRCoppYg0SWkklRuyt59NUVqpJJbpeXmlW1zhNlOXYo55ZppqFgafRWD2xKaVcco5Z5F1SqQenH3d+WVdfraZXnkb2ddYoH+uhCaiCeTpUHV83sQonopOeuSg2OnZp5cPpOnogJba+KlC1TFp1KZWCuRppaGuOCqApWr/iqqSnXa66o+pDnTrd5mmlqatYr7K0KI2ApuAsVPyOluHtsX1K5vCTiilscgmWh9vm0H34rO7ikQsi9R2i1xwT/oqZrWCejttseLCCZpyap3brmnrghvse7A1uy2n89JrZLheRnshuQZmJu+9kv7LbsCYRqavs6EKPCytC9PZcFmGGhwxoP/qyvDF2KKGl6UST9VqyQMv66TKhH3bL66TopwyoS0HKvOjjN48M1q3uWztTj4nq+haQgbt6pBEGX1pX+LFl+SSAer8qNKmDq3lfWlJbdTTR2s9YcYZer21g0hqOyOKSsGFto9rt72h23CXFPfcLpGqNt1rM/gw3mfzfgc232e/CXjeTQ8+I9GGh01z4iP6xbiCkD7eeOSSu1eq2JVzSRy8mTstWrbldg7lu3uLTll/pZveMulmq346wQW7bl6+qcu+3Oec2x4e7rnrfl3oBbLs++6LD/97r8a/vmfyri3PfPOFP79emdJ73nv1PbeO/ehkb+/992IFBAA7" alt="png"></span>

                           <p>И наконец, как вы наверно догадались, два случая - одиночный и двойной поровот в зависимости от цвета дочерних узлов соседа. Эти случаи вам уже знакомы (должны быть!), поэтому мы лишь вкратце по ним пройдёмся, прежде чем перейдём к коду. Если правый дочерний узел красный, мы делаем двойной поворот. Однако, в этом случае изменением цвета в rot_single() дело не ограничивается. Для пущей аккуратности мы форсируем правильный цвет во всех затронутых узлах:</p>

                           <span class="for_img"><img src="data:image/gif;base64,R0lGODlh8wBmAPcAAAAAAIAAAACAAICAAAAAgIAAgACAgICAgMDAwP8AAAD/AP//AAAA//8A/wD//////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP///ywAAAAA8wBmAAAI/wAfCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIcSCAjyA7ihyZEWRIkihTNgSZoKXLkypjxmTpsiVMmThFfqzJ8yWAnEA17uzJ82PQoxYBEF2a4CfSpw+VMu3pFKpVhVKnUr3K1WBWrTWrdu36FWzYsWTNEhWL9mlZtS/bQn0Lt6lct3WXsr07M+9avkHp5t0LGKXguoQLjzw8WLFKxogdP/arV7Jhyn8tk4Sc4IHZxJovHib4ObROsAJLm944uqZnraBXT4Ts+TXY2LKjqrU9FXduh5w7q/X9e2Fw4beLizbLu7fyisebV35OMbj06dQjWh+efTZz1d0hcv++njm8dtTgzQOfSr68+vVa2599D5+o/K306zO9bzP/yqUGJefff5jFNSBDxzl3IIIFGrhgQgkyRdyCEeL3IFYNTkhhhQ5eiCFlGh7oFIchbuhXif6JFSGKA44YmYdYecWZUSzSp+KMP9VoHmg0hWWURzAiRFiPPqkYZEHEmfQjkkcyiZWSQjb5gI4HUfmclQRhKZuWTgbJJZAeftnlhWKCWZySPKZUpmJrmikklGShCaebmz3YZpZVymnSXHrKKdCdY8q4511oVinTjX3OmVOifS4qaKNcMVoVoF79KamiM11aqKOWasqnppTmCeqgmY5K6qFTmoqUqaE+ymqprN7/BOuogcW6aKyn6oQrpobteiuuh+6aK0fCDrtYscEKO6uvxxYrq67OPuYspdM+W1K1oVYrbbS9agutnllKqia23U5bLrfEJpoqjYyO622z5sK7aafidtTunpeeO++66m7WL72Qfgslvp6KZ5y6BLcrb6EJB2wvwiHVK3CjoEoU270RS/ywp/lOPHDGCm+MccfaQQgxuyGLLC7J6VIM8r8tgwtwygaLCm7DMi98Msys7cyvwz2vzLJHFdvM8Ms5e3zz0EL5zHTTI9Ncs9Efowx0zDvzHPTSVietMtdSA/ekw09vDXbYUPuJs5/+Ht311SshGK++VZd9Ldg/s922ogWX/yw3unvvO7PgWO9r993I0q3qssC6m7jjjUO+OOO2Sh655UVTrrHmmWNOK06Xc+51spWT/ipQp6Peueqpg14664dvCzfsq5ve91Gbf2qtWxW3SjXEVxEuJXAp+/47psYPv6yhVgk/pfJhWpY89MFLTz2Ff+8+0/UivvmW9nUebCz3bCKJI+reU7Uk+Y5N+iLo5t82Pfuz/Xki+vbDNT/92nHYH/xTuh//+OK/DkkLM/sboHEa9L++FCiBChQSA+3iwAxFMFITbOBlGAjBC3okgxTc4AQ76EHaDAQ2k8kgCSNIG9coSIT7SY8HUVeX+wBqPPwJ4QxpCBcbwtA+yBHQDo4XxZzUoHAz35HhEFO4myMuJolCXGIFoeie06BHiVL8IXte+MQrOjGLU+wJb+STLS9yEYxqis8Jz2jFLUYRjWnkYBiB+EY4IlGOcxSgHfOoP9CNcI9+BBEPEQhIIjYmMIQspCG5syo9KtJ18mve+x7JOvWt0FKRpKTu1jcWItmEk5pkIa9CScpSmvKUOQkIADs=" alt="png"></span>

                           <p>Как обычно, мы убеждаемся, что цвет родительского узла не изменяется и чёрная высота обоих поддеревьев остаётся такой же, как исходная высота. Эти два правила помогают избежать красного и чёрного нарушения. Если левый дочерний узел соседа красный, то одинарного поворота более чем достаточно, чтобы сделать то же самое. Т.к. окончательные цвета те же, то перекрашивание в этом случае суммируется с предыдущим случаем:</p>

                           <span class="for_img"><img src="data:image/gif;base64,R0lGODlhDwFnAPcAAAAAAIAAAACAAICAAAAAgIAAgACAgICAgMDAwP8AAAD/AP//AAAA//8A/wD//////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP///ywAAAAADwFnAAAI/wAfCBxIsKDBgwgTKlzIsKHDhxAjSpxIEIDFixQzatzIsSPCixg9ihxJUuDFBChThizJsqXLhCdTolz5sqZNizJzqgRgs6dPjTh15rT4s6hHAEKTJuBptKnTikqFMn1KlSHSqFKrar2JNevWrwOvdtU5FazZjWLHyix71mlatWvbypX4Fu7MuU3r2r2Lty/MvV79cgU8VLBhqITjHnaplzDbxXIbA34MuaPkvZQrg71sN7PmjJwTPBjr+XNVyQRJmz7aVaDq1WZRyxyNtTRsh5xH0+5q+7bP0Ch3R+3t+29rtcSLvwQu+rXyiMCFD39Olbn0pMmphx17Hbt2t9yRf/9/GN35+J+huwc+b/U4b/ZGL6tfD9941PmK6/eUDTf7+fTm6bdcUga9J6BCzE134H6J5bfgQQkq5d+DFEXoHYUfNbgUhoMlNiF8QU3GIYOOjQihSSKaWFOI/alYUFkRfugiREzFOGNYBrGIHU8y3rgQjKER1aN2nsW0FlE4+ngUhDouhaRJLhIH0pMVKWnZj1N+ZOKQJ1oJmkhcrhZml15CR9KYlaFJZpkNqfmib1MWuRybbTKGJUibxZlllSvSiWCfOeqJ51OCCgrlTQjuCaKifAJqUqFx5gWpob8FCul3k07lplWPZjrob55Gil5YoW5aXammWoXqpyuuyiqirsL/uWp8rtLUUq2M3lQrbLiih6utZ/76KmO/mibsfsICC2ayVBJ7bJrJ6srsrcwqO1K1qTobrbbTloRts95WCxm2y33L0qQVZVouuYZ9m22n4gZb6AN4qsvttoK5Sy2l8KIrr6H12nvupaT6m++8sw6sJ70YlWpmogg3LPC/CwdMsF8EJxyuug4//NGlFl9MMbqeHlwxw6gqTHKoExUJssQGj/xyzHOtnPLG/N5M18cRC0nztQ6XjPHMHctcsdAvFp00wDDPuy/HSONls9JATy2yx5Ye7fPVVVvt9NA9s/x02FzjBjG/KJe9LNE/10z2xEannbbaP6ra7b1Z6gy21mKP/01T3zS2GS/ewMIt9dttr42vyr1Ku7jJjzO+a6uNO/7sYexSPrnlVGte+WJ3cw646Imvuzm0nyOrN6ij+xqrmKe7HjWtdLO++rhzz07711qJ+lXK7zp6O6G5+lkw78HfmjXaxqOubPLeng1u8+NBDyb1ZVrPkfbYp2m3tXZ2nz3PZE0fvfhsstVk+XOiT6emnVVYPPfuf1Zjirg1GRL99dtvoUqC4w3/+qeZ/zkIQvEjYPY0xBcEYkaBXjJgYRyIPwhGiYEAfJGGBmjByGCwgShiIAc7GBuspEZB2xEhCUeUm9mgkF4f3NAKKRQh/MgQhh8c4QyrYxcbwi+HO3xQdKhcU5sQEmggAQoiiHpYRBwKRTg2BKES2VNDFPInOEmcYvXggp8fPtGFBtLiEpUCRSuSEYxNFCMVTYhEMxIIjRJSo34keMDGlDGNcvwPBtX3xpREUYd5/M0Gc9RHLOIxkFssEQVzcsIXIlKPD8yQCh9ZHxshaJCUnGOQpOShTC7ISDvxz/8A6UniDQs3CSxl/9Y3FFKqsjignIn5XrnK4tHylrjMpS6fExAAOw==" alt="png"></span>

                           <p>Теперь весёлая часть. Алгоритм будет использовать осторожное удаление, причём узел, который должен быть удалён, сохраняется, а цикл продолжается, пока не найден узел-предшественник (младший узел, содержащий значение, по порядку предшествующее тому, которое хранит удаляемый узел - перев.). На этом цикл прохода вниз завершается, копируются данные и внешние узлы сращиваются с деревом в противоположность обычному удалению копированием, когда поиск останавливается при нахождении узла, а для нахождения узла-предшественника (младшего узла) используется дополнительный шаг. На пути вниз мы также проверяем описанные выше случаи и обрабатываем их:</p>


                           <pre class="cpp" style="font-family:monospace; text-align: left;"> <span style="color: #0000dd;">1</span> <span style="color: #0000ff;">int</span> <span style="color: #0000dd;">remove</span> <span style="color: #008000;">&#40;</span><span style="color: #0000ff;">struct</span> tree <span style="color: #000040;">*</span>tree, <span style="color: #0000ff;">int</span> data<span style="color: #008000;">&#41;</span>
                            <span style="color: #0000dd;">2</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">3</span>       <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                            <span style="color: #0000dd;">4</span>             <span style="color: #0000ff;">struct</span> node head <span style="color: #000080;">=</span> <span style="color: #008000;">&#123;</span> <span style="color: #0000dd;">0</span> <span style="color: #008000;">&#125;</span><span style="color: #008080;">;</span> <span style="color: #ff0000; font-style: italic;">/* False tree root */</span>
                            <span style="color: #0000dd;">5</span>             <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>q, <span style="color: #000040;">*</span>p, <span style="color: #000040;">*</span>g<span style="color: #008080;">;</span> <span style="color: #ff0000; font-style: italic;">/* Helpers */</span>
                            <span style="color: #0000dd;">6</span>             <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>f <span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008080;">;</span>  <span style="color: #ff0000; font-style: italic;">/* Found item */</span>
                            <span style="color: #0000dd;">7</span>             <span style="color: #0000ff;">int</span> dir <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                            <span style="color: #0000dd;">8</span>
                            <span style="color: #0000dd;">9</span>             <span style="color: #ff0000; font-style: italic;">/* Set up helpers */</span>
                           <span style="color: #0000dd;">10</span>             q <span style="color: #000080;">=</span> <span style="color: #000040;">&amp;</span>head<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">11</span>             g <span style="color: #000080;">=</span> p <span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">12</span>             q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">13</span>
                           <span style="color: #0000dd;">14</span>             <span style="color: #ff0000; font-style: italic;">/* Search and push a red down */</span>
                           <span style="color: #0000dd;">15</span>             <span style="color: #0000ff;">while</span> <span style="color: #008000;">&#40;</span>q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">16</span>                   <span style="color: #0000ff;">int</span> last <span style="color: #000080;">=</span> dir<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">17</span>
                           <span style="color: #0000dd;">18</span>                   <span style="color: #ff0000; font-style: italic;">/* Update helpers */</span>
                           <span style="color: #0000dd;">19</span>                   g <span style="color: #000080;">=</span> p, p <span style="color: #000080;">=</span> q<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">20</span>                   q <span style="color: #000080;">=</span> q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">21</span>                   dir <span style="color: #000080;">=</span> q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">&lt;</span> data<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">22</span>
                           <span style="color: #0000dd;">23</span>                   <span style="color: #ff0000; font-style: italic;">/* Save found node */</span>
                           <span style="color: #0000dd;">24</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">==</span> data<span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">25</span>                         f <span style="color: #000080;">=</span> q<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">26</span>
                           <span style="color: #0000dd;">27</span>                   <span style="color: #ff0000; font-style: italic;">/* Push the red node down */</span>
                           <span style="color: #0000dd;">28</span>                   <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>q<span style="color: #008000;">&#41;</span> <span style="color: #000040;">&amp;&amp;</span> <span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">29</span>                         <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">30</span>                               p <span style="color: #000080;">=</span> p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>last<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>q, dir<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">31</span>                         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>dir<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">32</span>                               <span style="color: #0000ff;">struct</span> node <span style="color: #000040;">*</span>s <span style="color: #000080;">=</span> p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>last<span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">33</span>
                           <span style="color: #0000dd;">34</span>                               <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>s <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">35</span>                                     <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>last<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span> <span style="color: #000040;">&amp;&amp;</span> <span style="color: #000040;">!</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>last<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">36</span>                                           <span style="color: #ff0000; font-style: italic;">/* Color flip */</span>
                           <span style="color: #0000dd;">37</span>                                           p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">38</span>                                           s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">39</span>                                           q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">40</span>                                     <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">41</span>                                     <span style="color: #0000ff;">else</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">42</span>                                           <span style="color: #0000ff;">int</span> dir2 <span style="color: #000080;">=</span> g<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">==</span> p<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">43</span>
                           <span style="color: #0000dd;">44</span>                                           <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>last<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">45</span>                                                 g<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir2<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> rot_double <span style="color: #008000;">&#40;</span>p, last<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">46</span>                                           <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>is_red <span style="color: #008000;">&#40;</span>s<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #000040;">!</span>last<span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">47</span>                                                 g<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir2<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span> rot_single <span style="color: #008000;">&#40;</span>p, last<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">48</span>
                           <span style="color: #0000dd;">49</span>                                           <span style="color: #ff0000; font-style: italic;">/* Ensure correct coloring */</span>
                           <span style="color: #0000dd;">50</span>                                           q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> g<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir2<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">51</span>                                           g<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir2<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">52</span>                                           g<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>dir2<span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">53</span>                                     <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">54</span>                               <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">55</span>                         <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">56</span>                   <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">57</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">58</span>
                           <span style="color: #0000dd;">59</span>             <span style="color: #ff0000; font-style: italic;">/* Replace and remove if found */</span>
                           <span style="color: #0000dd;">60</span>             <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>f <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
                           <span style="color: #0000dd;">61</span>                   f<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data <span style="color: #000080;">=</span> q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>data<span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">62</span>                   p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>p<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">==</span> q<span style="color: #008000;">&#93;</span> <span style="color: #000080;">=</span>
                           <span style="color: #0000dd;">63</span>                         q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span>q<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>link <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#93;</span> <span style="color: #000080;">==</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">64</span>                   <span style="color: #0000dd;">free</span> <span style="color: #008000;">&#40;</span>q<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">65</span>             <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">66</span>
                           <span style="color: #0000dd;">67</span>             <span style="color: #ff0000; font-style: italic;">/* Update root and make it black */</span>
                           <span style="color: #0000dd;">68</span>             tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000080;">=</span> head.<span style="color: #007788;">link</span> <span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">69</span>             <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span>
                           <span style="color: #0000dd;">70</span>                   tree<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>root<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>red <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">71</span>       <span style="color: #008000;">&#125;</span>
                           <span style="color: #0000dd;">72</span>
                           <span style="color: #0000dd;">73</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span><span style="color: #008080;">;</span>
                           <span style="color: #0000dd;">74</span> <span style="color: #008000;">&#125;</span></pre>

                           <p>Функция, реализующая алгоритм, короткая и красивая, хотя, пожалуй многочисленные отступы сделают код несколько безвкусным в чьих-то глазах. В качестве упражнения попытайтесь уменьшить код.</p>
                           <p>Это и есть удаление сверху вниз и его можно сравнить с удалением снизу вверх, так же, как и вставку, но теперь мы можем судить о том, что код операции удаления сверху вниз короче и (я думаю) проще. Красно-чёрные деревья проще поддаются пониманию при использовании алгоритмов, работающих сверху вниз, но к сожалению на фоне того, что единственный широко известный источник, который даёт код для операции удаления - это CLR, большая часть реализаций использует алгоритмы, работающие снизу вверх.</p>






                    <!-- /CLIENTS -->
                </section>
                <!-- /ABOUT -->

            </div>
            <!-- /CONTENT AREA INNER -->


        </div>
        <!-- /CONTENT AREA -->
        
        
        <!-- JAVASCRIPTS -->
        <script>
            ScrollReveal().reveal('.scroll-animated', 
            { 
                delay: 700,
                origin: "left",
                rotate: { x: 0, y: 0, z: 0 },
                opacity: 0,
                distance: "60px"})

            ScrollReveal().reveal('.headline', 
            { 
                delay: 500,
                origin: "left",
                rotate: { x: 0, y: 0, z: 0 },
                opacity: 0,
                distance: "60px"})    
        </script>
    </body> 
    
    
</html>